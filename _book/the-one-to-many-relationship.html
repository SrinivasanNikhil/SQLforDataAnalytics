<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 The One-to-Many Relationship | DataManagement.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 The One-to-Many Relationship | DataManagement.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 The One-to-Many Relationship | DataManagement.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-single-entity.html"/>
<link rel="next" href="the-many-to-many-relationship.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="data-management-databases-and-organizations.html"><a href="data-management-databases-and-organizations.html"><i class="fa fa-check"></i>Data Management: Databases and Organizations</a>
<ul>
<li class="chapter" data-level="" data-path="data-management-databases-and-organizations.html"><a href="data-management-databases-and-organizations.html#open-edition"><i class="fa fa-check"></i><em>Open Edition</em></a></li>
<li class="chapter" data-level="" data-path="data-management-databases-and-organizations.html"><a href="data-management-databases-and-organizations.html#richard-t.-watson"><i class="fa fa-check"></i>Richard T. Watson</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#supplements"><i class="fa fa-check"></i>Supplements</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="section-1-introduction-to-sql.html"><a href="section-1-introduction-to-sql.html"><i class="fa fa-check"></i>Section 1 Introduction to SQL</a></li>
<li class="chapter" data-level="1" data-path="the-single-entity.html"><a href="the-single-entity.html"><i class="fa fa-check"></i><b>1</b> The Single Entity</a>
<ul>
<li class="chapter" data-level="1.1" data-path="the-single-entity.html"><a href="the-single-entity.html#the-relational-model"><i class="fa fa-check"></i><b>1.1</b> The relational model</a></li>
<li class="chapter" data-level="1.2" data-path="the-single-entity.html"><a href="the-single-entity.html#getting-started"><i class="fa fa-check"></i><b>1.2</b> Getting started</a></li>
<li class="chapter" data-level="1.3" data-path="the-single-entity.html"><a href="the-single-entity.html#modeling-a-single-entity-database"><i class="fa fa-check"></i><b>1.3</b> Modeling a single-entity database</a></li>
<li class="chapter" data-level="1.4" data-path="the-single-entity.html"><a href="the-single-entity.html#querying-a-single-table-database"><i class="fa fa-check"></i><b>1.4</b> Querying a single-table database</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="the-single-entity.html"><a href="the-single-entity.html#displaying-an-entire-table"><i class="fa fa-check"></i><b>1.4.1</b> Displaying an entire table</a></li>
<li class="chapter" data-level="1.4.2" data-path="the-single-entity.html"><a href="the-single-entity.html#projectchoosing-columns"><i class="fa fa-check"></i><b>1.4.2</b> Project—choosing columns</a></li>
<li class="chapter" data-level="1.4.3" data-path="the-single-entity.html"><a href="the-single-entity.html#restrictchoosing-rows"><i class="fa fa-check"></i><b>1.4.3</b> Restrict—choosing rows</a></li>
<li class="chapter" data-level="1.4.4" data-path="the-single-entity.html"><a href="the-single-entity.html#combining-project-and-restrictchoosing-rows-and-columns"><i class="fa fa-check"></i><b>1.4.4</b> Combining project and restrict—choosing rows and columns</a></li>
<li class="chapter" data-level="1.4.5" data-path="the-single-entity.html"><a href="the-single-entity.html#more-about-where"><i class="fa fa-check"></i><b>1.4.5</b> More about WHERE</a></li>
<li class="chapter" data-level="1.4.6" data-path="the-single-entity.html"><a href="the-single-entity.html#the-power-of-the-primary-key"><i class="fa fa-check"></i><b>1.4.6</b> The power of the primary key</a></li>
<li class="chapter" data-level="1.4.7" data-path="the-single-entity.html"><a href="the-single-entity.html#the-in-crowd"><i class="fa fa-check"></i><b>1.4.7</b> The IN crowd</a></li>
<li class="chapter" data-level="1.4.8" data-path="the-single-entity.html"><a href="the-single-entity.html#the-not-in-crowd"><i class="fa fa-check"></i><b>1.4.8</b> The NOT IN crowd</a></li>
<li class="chapter" data-level="1.4.9" data-path="the-single-entity.html"><a href="the-single-entity.html#ordering-columns"><i class="fa fa-check"></i><b>1.4.9</b> Ordering columns</a></li>
<li class="chapter" data-level="1.4.10" data-path="the-single-entity.html"><a href="the-single-entity.html#regular-expressionpattern-matching"><i class="fa fa-check"></i><b>1.4.10</b> Regular expression—pattern matching</a></li>
<li class="chapter" data-level="1.4.11" data-path="the-single-entity.html"><a href="the-single-entity.html#ordering-rows"><i class="fa fa-check"></i><b>1.4.11</b> Ordering rows</a></li>
<li class="chapter" data-level="1.4.12" data-path="the-single-entity.html"><a href="the-single-entity.html#numeric-versus-character-sorting"><i class="fa fa-check"></i><b>1.4.12</b> Numeric versus character sorting</a></li>
<li class="chapter" data-level="1.4.13" data-path="the-single-entity.html"><a href="the-single-entity.html#derived-data"><i class="fa fa-check"></i><b>1.4.13</b> Derived data</a></li>
<li class="chapter" data-level="1.4.14" data-path="the-single-entity.html"><a href="the-single-entity.html#aggregate-functions"><i class="fa fa-check"></i><b>1.4.14</b> Aggregate functions</a></li>
<li class="chapter" data-level="1.4.15" data-path="the-single-entity.html"><a href="the-single-entity.html#subqueries"><i class="fa fa-check"></i><b>1.4.15</b> Subqueries</a></li>
<li class="chapter" data-level="" data-path="the-single-entity.html"><a href="the-single-entity.html#quotes"><i class="fa fa-check"></i>Quotes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-single-entity.html"><a href="the-single-entity.html#summary"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="the-single-entity.html"><a href="the-single-entity.html#key-terms-and-concepts"><i class="fa fa-check"></i>Key terms and concepts</a></li>
<li class="chapter" data-level="" data-path="the-single-entity.html"><a href="the-single-entity.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html"><i class="fa fa-check"></i><b>2</b> The One-to-Many Relationship</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#relationships"><i class="fa fa-check"></i><b>2.1</b> Relationships</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#why-did-we-create-an-additional-entity"><i class="fa fa-check"></i><b>2.1.1</b> Why did we create an additional entity?</a></li>
<li class="chapter" data-level="2.1.2" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#mysql-workbench"><i class="fa fa-check"></i><b>2.1.2</b> MySQL Workbench</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#querying-a-two-table-database"><i class="fa fa-check"></i><b>2.2</b> Querying a two-table database</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#join"><i class="fa fa-check"></i><b>2.2.1</b> Join</a></li>
<li class="chapter" data-level="2.2.2" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#group-byreporting-by-groups"><i class="fa fa-check"></i><b>2.2.2</b> GROUP BY—reporting by groups</a></li>
<li class="chapter" data-level="2.2.3" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#havingthe-where-clause-of-groups"><i class="fa fa-check"></i><b>2.2.3</b> HAVING—the WHERE clause of groups</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#regular-expressionpattern-matching-1"><i class="fa fa-check"></i><b>2.3</b> Regular expression—pattern matching</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-for-a-string-not-containing-specified-characters"><i class="fa fa-check"></i><b>2.3.1</b> Search for a string not containing specified characters</a></li>
<li class="chapter" data-level="2.3.2" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-for-string-containing-a-repeated-pattern-or-repetition"><i class="fa fa-check"></i><b>2.3.2</b> Search for string containing a repeated pattern or repetition</a></li>
<li class="chapter" data-level="2.3.3" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-combining-alternation-and-repetition"><i class="fa fa-check"></i><b>2.3.3</b> Search combining alternation and repetition</a></li>
<li class="chapter" data-level="2.3.4" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-for-multiple-versions-of-a-string"><i class="fa fa-check"></i><b>2.3.4</b> Search for multiple versions of a string</a></li>
<li class="chapter" data-level="2.3.5" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-for-a-string-in-a-particular-position"><i class="fa fa-check"></i><b>2.3.5</b> Search for a string in a particular position</a></li>
<li class="chapter" data-level="2.3.6" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-for-a-string-not-containing-any-specified-characters"><i class="fa fa-check"></i><b>2.3.6</b> Search for a string not containing any specified characters</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#subqueries-1"><i class="fa fa-check"></i><b>2.4</b> Subqueries</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#correlated-subquery"><i class="fa fa-check"></i><b>2.4.1</b> Correlated subquery</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#summary-1"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#key-terms-and-concepts-1"><i class="fa fa-check"></i>Key terms and concepts</a></li>
<li class="chapter" data-level="" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#exercises-1"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html"><i class="fa fa-check"></i><b>3</b> The Many-to-Many Relationship</a>
<ul>
<li class="chapter" data-level="" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#learning-objectives-2"><i class="fa fa-check"></i>Learning objectives</a></li>
<li class="chapter" data-level="3.1" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#the-many-to-many-relationship-1"><i class="fa fa-check"></i><b>3.1</b> The many-to-many relationship</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#mysql-workbench-1"><i class="fa fa-check"></i><b>3.1.1</b> MySQL Workbench</a></li>
<li class="chapter" data-level="3.1.2" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#why-did-we-create-a-third-entity"><i class="fa fa-check"></i><b>3.1.2</b> Why did we create a third entity?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#querying-an-mm-relationship"><i class="fa fa-check"></i><b>3.2</b> Querying an m:m relationship</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#a-three-table-join"><i class="fa fa-check"></i><b>3.2.1</b> A three-table join</a></li>
<li class="chapter" data-level="3.2.2" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#existsdoes-a-value-exist"><i class="fa fa-check"></i><b>3.2.2</b> EXISTS—does a value exist</a></li>
<li class="chapter" data-level="3.2.3" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#not-existsselect-a-value-if-it-does-not-exist"><i class="fa fa-check"></i><b>3.2.3</b> NOT EXISTS—select a value if it does not exist</a></li>
<li class="chapter" data-level="" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#set-operations"><i class="fa fa-check"></i>Set operations</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#summary-2"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#key-terms-and-concepts-2"><i class="fa fa-check"></i>Key terms and concepts</a></li>
<li class="chapter" data-level="" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#exercises-2"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sql.html"><a href="sql.html"><i class="fa fa-check"></i><b>4</b> SQL</a>
<ul>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#learning-objectives-3"><i class="fa fa-check"></i>Learning objectives</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#structured-query-language"><i class="fa fa-check"></i>Structured query language</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#data-types"><i class="fa fa-check"></i>Data types</a>
<ul>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#boolean"><i class="fa fa-check"></i>BOOLEAN</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#smallint-and-integer"><i class="fa fa-check"></i>SMALLINT and INTEGER</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#float"><i class="fa fa-check"></i>FLOAT</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#decimal"><i class="fa fa-check"></i>DECIMAL</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#char-and-varchar"><i class="fa fa-check"></i>CHAR and VARCHAR</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#times-and-dates"><i class="fa fa-check"></i>Times and dates</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#blob-binary-large-object"><i class="fa fa-check"></i>BLOB (binary large object)</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#clob-character-large-object"><i class="fa fa-check"></i>CLOB (character large object)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#scalar-functions"><i class="fa fa-check"></i>Scalar functions</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#formatting"><i class="fa fa-check"></i>Formatting</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#data-manipulation"><i class="fa fa-check"></i>Data manipulation</a>
<ul>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#qualifying-column-names"><i class="fa fa-check"></i>Qualifying column names</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#select"><i class="fa fa-check"></i>SELECT</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#product"><i class="fa fa-check"></i>Product</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#inner-join"><i class="fa fa-check"></i>Inner join</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#outer-join"><i class="fa fa-check"></i>Outer join</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#simple-subquery"><i class="fa fa-check"></i>Simple subquery</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#aggregate-functions-1"><i class="fa fa-check"></i>Aggregate functions</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#group-by-and-having"><i class="fa fa-check"></i>GROUP BY and HAVING</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#regexp"><i class="fa fa-check"></i>REGEXP</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#universal-unique-identifier-uuid"><i class="fa fa-check"></i>Universal Unique Identifier (UUID)</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#nullsmuch-ado-about-missing-information"><i class="fa fa-check"></i>Nulls—much ado about missing information</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#the-future-of-sql"><i class="fa fa-check"></i>The future of SQL</a>
<ul>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#summary-3"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#references-and-additional-readings"><i class="fa fa-check"></i>References and additional readings</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-one-to-many-relationship" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Chapter 2</span> The One-to-Many Relationship<a href="the-one-to-many-relationship.html#the-one-to-many-relationship" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p><em>Cow of many—well milked and badly fed.</em></p>
<p>Spanish proverb</p>
</blockquote>
<div id="learning-objectives-1" class="section level4 unnumbered hasAnchor">
<h4>Learning Objectives<a href="the-one-to-many-relationship.html#learning-objectives-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Students completing this chapter will be able to</p>
<ul>
<li>write queries for a database with a one-to-many relationship.</li>
</ul>
</div>
<div id="relationships" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Relationships<a href="the-one-to-many-relationship.html#relationships" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Entities are not isolated; they are related to other entities. When we move beyond the single entity, we need to identify the relationships between entities to accurately represent the real world. Consider the case where a person’s stocks are listed in different countries. We now need to introduce an entity called NATION. We now have two entities, STOCK and NATION. Consider the relationship between them. A NATION can have many listed stocks. A stock, in this case, is listed in only one nation. There is a 1:m (one-to-many) relationship between NATION and STOCK.</p>
<p>A 1:m relationship between two entities is depicted by a line connecting the two with a crow’s foot at the many end of the relationship. The following figure shows the 1:m relationship between NATION and STOCK. This can be read as: “a nation can have many stocks, but a stock belongs to only one nation.” The entity NATION is identified by <em>nation code</em> and has attributes <em>nation name</em> and <em>exchange rate</em>.</p>
<p><em>A 1:m relationship between NATION and STOCK</em></p>
<p><img src="Figures/Chapter%204/nation-stock.png" width="376" /></p>
<p>The 1:m relationship occurs frequently in business situations. Sometimes it occurs in a tree or hierarchical fashion. Consider a very hierarchical firm. It has many divisions, but a division belongs to only one firm. A division has many departments, but a department belongs to only one division. A department has many sections, but a section belongs to only one department.</p>
<p><em>A series of 1:m relationships</em></p>
<p><img src="Figures/Chapter%204/hierarchy.png" /></p>
<div id="why-did-we-create-an-additional-entity" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Why did we create an additional entity?<a href="the-one-to-many-relationship.html#why-did-we-create-an-additional-entity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Another approach to adding data about listing nation and exchange rate is to add two attributes to STOCK: <em>nation name</em> and <em>exchange rate</em>. At first glance, this seems a very workable solution; however, this will introduce considerable redundancy, as the following table illustrates.</p>
<p><em>The table stock with additional columns</em></p>
<table>
<colgroup>
<col width="11%" />
<col width="22%" />
<col width="10%" />
<col width="9%" />
<col width="8%" />
<col width="7%" />
<col width="17%" />
<col width="10%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">*stkcode</th>
<th align="left">stkfirm</th>
<th align="right">stkprice</th>
<th align="right">stkqty</th>
<th align="right">stkdiv</th>
<th align="right">stkpe</th>
<th align="left">natname</th>
<th align="right">exchrate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">FC</td>
<td align="left">Freedonia Copper</td>
<td align="right">27.5</td>
<td align="right">10529</td>
<td align="right">1.84</td>
<td align="right">16</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">PT</td>
<td align="left">Patagonian Tea</td>
<td align="right">55.25</td>
<td align="right">12635</td>
<td align="right">2.5</td>
<td align="right">10</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">AR</td>
<td align="left">Abyssinian Ruby</td>
<td align="right">31.82</td>
<td align="right">22010</td>
<td align="right">1.32</td>
<td align="right">13</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">SLG</td>
<td align="left">Sri Lankan Gold</td>
<td align="right">50.37</td>
<td align="right">32868</td>
<td align="right">2.68</td>
<td align="right">16</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">ILZ</td>
<td align="left">Indian Lead &amp; Zinc</td>
<td align="right">37.75</td>
<td align="right">6390</td>
<td align="right">3</td>
<td align="right">12</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">Burmese Elephant</td>
<td align="right">0.07</td>
<td align="right">154713</td>
<td align="right">0.01</td>
<td align="right">3</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">BS</td>
<td align="left">Bolivian Sheep</td>
<td align="right">12.75</td>
<td align="right">231678</td>
<td align="right">1.78</td>
<td align="right">11</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">NG</td>
<td align="left">Nigerian Geese</td>
<td align="right">35</td>
<td align="right">12323</td>
<td align="right">1.68</td>
<td align="right">10</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">CS</td>
<td align="left">Canadian Sugar</td>
<td align="right">52.78</td>
<td align="right">4716</td>
<td align="right">2.5</td>
<td align="right">15</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">ROF</td>
<td align="left">Royal Ostrich Farms</td>
<td align="right">33.75</td>
<td align="right">1234923</td>
<td align="right">3</td>
<td align="right">6</td>
<td align="left">United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">MG</td>
<td align="left">Minnesota Gold</td>
<td align="right">53.87</td>
<td align="right">816122</td>
<td align="right">1</td>
<td align="right">25</td>
<td align="left">USA</td>
<td align="right">0.67</td>
</tr>
<tr class="even">
<td align="left">GP</td>
<td align="left">Georgia Peach</td>
<td align="right">2.35</td>
<td align="right">387333</td>
<td align="right">0.2</td>
<td align="right">5</td>
<td align="left">USA</td>
<td align="right">0.67</td>
</tr>
<tr class="odd">
<td align="left">NE</td>
<td align="left">Narembeen Emu</td>
<td align="right">12.34</td>
<td align="right">45619</td>
<td align="right">1</td>
<td align="right">8</td>
<td align="left">Australia</td>
<td align="right">0.46</td>
</tr>
<tr class="even">
<td align="left">QD</td>
<td align="left">Queensland Diamond</td>
<td align="right">6.73</td>
<td align="right">89251</td>
<td align="right">0.5</td>
<td align="right">7</td>
<td align="left">Australia</td>
<td align="right">0.46</td>
</tr>
<tr class="odd">
<td align="left">IR</td>
<td align="left">Indooroopilly Ruby</td>
<td align="right">15.92</td>
<td align="right">56147</td>
<td align="right">0.5</td>
<td align="right">20</td>
<td align="left">Australia</td>
<td align="right">0.46</td>
</tr>
<tr class="even">
<td align="left">BD</td>
<td align="left">Bombay Duck</td>
<td align="right">25.55</td>
<td align="right">167382</td>
<td align="right">1</td>
<td align="right">12</td>
<td align="left">India</td>
<td align="right">0.0228</td>
</tr>
</tbody>
</table>
<p>The exact same nation name and exchange rate pair occurs 10 times for stocks listed in the United Kingdom. This redundancy presents problems when we want to insert, delete, or update data. These problems, generally known as <strong>update anomalies</strong>, occur with these three basic operations.</p>
<div id="insert-anomalies" class="section level4 hasAnchor" number="2.1.1.1">
<h4><span class="header-section-number">2.1.1.1</span> Insert anomalies<a href="the-one-to-many-relationship.html#insert-anomalies" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We cannot insert a fact about a nation’s exchange rate unless we first buy a stock that is listed in that nation. Consider the case where we want to keep a record of France’s exchange rate and we have no French stocks. We cannot skirt this problem by putting in a null entry for stock details because stkcode, the primary key, would be null, and this is not allowed. If we have a separate table for facts about a nation, then we can easily add new nations without having to buy stocks. This is particularly useful when other parts of the organization, say International Trading, also need access to exchange rates for many nations.</p>
</div>
<div id="delete-anomalies" class="section level4 hasAnchor" number="2.1.1.2">
<h4><span class="header-section-number">2.1.1.2</span> Delete anomalies<a href="the-one-to-many-relationship.html#delete-anomalies" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If we delete data about a particular stock, we might also lose a fact about exchange rates. For example, if we delete details of Bombay Duck, we also erase the Indian exchange rate.</p>
</div>
<div id="update-anomalies" class="section level4 hasAnchor" number="2.1.1.3">
<h4><span class="header-section-number">2.1.1.3</span> Update anomalies<a href="the-one-to-many-relationship.html#update-anomalies" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Exchange rates are volatile. Most companies need to update them every day. What happens when the Australian exchange rate changes? Every row in stock with nation = ‘Australia’ will have to be updated. In a large portfolio, many rows will be changed. There is also the danger of someone forgetting to update all the instances of the nation and exchange rate pair. As a result, there could be two exchange rates for the one nation. If exchange rate is stored in a nation table, however, only one change is necessary, there is no redundancy, and there is no danger of inconsistent exchange rates.</p>
<p>The 1:m relationship is mapped by adding a column to the entity at the many end of the relationship. The additional column contains the identifier of the one end of the relationship.</p>
<p>Consider the relationship between the entities STOCK and NATION. The database has two tables: <code>stock</code> and <code>nation.</code> The table stock has an additional column, natcode, which contains the primary key of nation. If natcode is not stored in <code>stock</code>, then there is no way of knowing the identity of the nation where the <code>stock</code> is listed.</p>
<p><em>A relational database with tables nation and stock</em></p>
<table>
<thead>
<tr class="header">
<th align="left">nation</th>
<th></th>
<th align="right"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">*natcode</td>
<td>natname</td>
<td align="right">exchrate</td>
</tr>
<tr class="even">
<td align="left">AUS</td>
<td>Australia</td>
<td align="right">0.46</td>
</tr>
<tr class="odd">
<td align="left">IND</td>
<td>India</td>
<td align="right">0.0228</td>
</tr>
<tr class="even">
<td align="left">UK</td>
<td>United Kingdom</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">USA</td>
<td>United States</td>
<td align="right">0.67</td>
</tr>
</tbody>
</table>
<table style="width:100%;">
<colgroup>
<col width="13%" />
<col width="26%" />
<col width="12%" />
<col width="13%" />
<col width="10%" />
<col width="8%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">stock</th>
<th></th>
<th align="right"></th>
<th align="right"></th>
<th align="right"></th>
<th align="right"></th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">*stkcode</td>
<td>stkfirm</td>
<td align="right">stkprice</td>
<td align="right">stkqty</td>
<td align="right">stkdiv</td>
<td align="right">stkpe</td>
<td><em>natcode</em></td>
</tr>
<tr class="even">
<td align="left">FC</td>
<td>Freedonia Copper</td>
<td align="right">27.5</td>
<td align="right">10,529</td>
<td align="right">1.84</td>
<td align="right">16</td>
<td>UK</td>
</tr>
<tr class="odd">
<td align="left">PT</td>
<td>Patagonian Tea</td>
<td align="right">55.25</td>
<td align="right">12,635</td>
<td align="right">2.5</td>
<td align="right">10</td>
<td>UK</td>
</tr>
<tr class="even">
<td align="left">AR</td>
<td>Abyssinian Ruby</td>
<td align="right">31.82</td>
<td align="right">22,010</td>
<td align="right">1.32</td>
<td align="right">13</td>
<td>UK</td>
</tr>
<tr class="odd">
<td align="left">SLG</td>
<td>Sri Lankan Gold</td>
<td align="right">50.37</td>
<td align="right">32,868</td>
<td align="right">2.68</td>
<td align="right">16</td>
<td>UK</td>
</tr>
<tr class="even">
<td align="left">ILZ</td>
<td>Indian Lead &amp; Zinc</td>
<td align="right">37.75</td>
<td align="right">6,390</td>
<td align="right">3</td>
<td align="right">12</td>
<td>UK</td>
</tr>
<tr class="odd">
<td align="left">BE</td>
<td>Burmese Elephant</td>
<td align="right">0.07</td>
<td align="right">154,713</td>
<td align="right">0.01</td>
<td align="right">3</td>
<td>UK</td>
</tr>
<tr class="even">
<td align="left">BS</td>
<td>Bolivian Sheep</td>
<td align="right">12.75</td>
<td align="right">231,678</td>
<td align="right">1.78</td>
<td align="right">11</td>
<td>UK</td>
</tr>
<tr class="odd">
<td align="left">NG</td>
<td>Nigerian Geese</td>
<td align="right">35</td>
<td align="right">12,323</td>
<td align="right">1.68</td>
<td align="right">10</td>
<td>UK</td>
</tr>
<tr class="even">
<td align="left">CS</td>
<td>Canadian Sugar</td>
<td align="right">52.78</td>
<td align="right">4,716</td>
<td align="right">2.5</td>
<td align="right">15</td>
<td>UK</td>
</tr>
<tr class="odd">
<td align="left">ROF</td>
<td>Royal Ostrich Farms</td>
<td align="right">33.75</td>
<td align="right">1,234,923</td>
<td align="right">3</td>
<td align="right">6</td>
<td>UK</td>
</tr>
<tr class="even">
<td align="left">MG</td>
<td>Minnesota Gold</td>
<td align="right">53.87</td>
<td align="right">816,122</td>
<td align="right">1</td>
<td align="right">25</td>
<td>USA</td>
</tr>
<tr class="odd">
<td align="left">GP</td>
<td>Georgia Peach</td>
<td align="right">2.35</td>
<td align="right">387,333</td>
<td align="right">0.2</td>
<td align="right">5</td>
<td>USA</td>
</tr>
<tr class="even">
<td align="left">NE</td>
<td>Narembeen Emu</td>
<td align="right">12.34</td>
<td align="right">45,619</td>
<td align="right">1</td>
<td align="right">8</td>
<td>AUS</td>
</tr>
<tr class="odd">
<td align="left">QD</td>
<td>Queensland Diamond</td>
<td align="right">6.73</td>
<td align="right">89,251</td>
<td align="right">0.5</td>
<td align="right">7</td>
<td>AUS</td>
</tr>
<tr class="even">
<td align="left">IR</td>
<td>Indooroopilly Ruby</td>
<td align="right">15.92</td>
<td align="right">56,147</td>
<td align="right">0.5</td>
<td align="right">20</td>
<td>AUS</td>
</tr>
<tr class="odd">
<td align="left">BD</td>
<td>Bombay Duck</td>
<td align="right">25.55</td>
<td align="right">167,382</td>
<td align="right">1</td>
<td align="right">12</td>
<td>IND</td>
</tr>
</tbody>
</table>
<p>Notice that <code>natcode</code> appears in both the <code>stock</code> and <code>nation</code> tables. In <code>nation</code>, <code>natcode</code> is the primary key; it is unique for each instance of <code>nation.</code> In table <code>stock</code>, <code>natcode</code> is a <strong>foreign key</strong> because it is the primary key of <code>nation</code>, the one end of the 1:m relationship. The column <code>natcode</code> is a foreign key in <code>stock</code> because it is a primary key in <code>nation</code>. A matched primary key–foreign key pair is the method for recording the 1:m relationship between the two tables. This method of representing a relationship is illustrated using shading and arrows for the two USA stocks. In the <code>stock</code> table, <code>natcode</code> is italicized to indicate that it is a foreign key. This method, like asterisking a primary key, is a useful reminder.</p>
<p>Although the same name has been used for the primary key and the foreign key in this example, it is not mandatory. The two columns can have different names, and in some cases you are forced to use different names. When possible, we find it convenient to use identical column names to help us remember that the tables are related. To distinguish between columns with identical names, they must by <strong>qualified</strong> by prefixing the table name. In this case, use <code>nation.natcode</code> and <code>stock.natcode.</code> Thus, <code>nation.natcode</code> refers to the <code>natcode</code> column in the table <code>nation.</code></p>
<p>Although a nation can have many stocks, it is not mandatory to have any. That is, in data modeling terminology, many can be zero, one, or more, but it is mandatory to have a value for <code>natcode</code> in <code>nation</code> for every value of <code>natcode</code> in <code>stock</code>. This requirement, known as the <strong>referential integrity constraint</strong>, helps maintain the accuracy of a database. Its application means that every foreign key in a table has an identical primary key in that same table or another table. In this example, it means that for every value of <code>natcode</code> in <code>stock</code>, there is a corresponding entry in <code>nation</code>. As a result, a primary key row must be created before its corresponding foreign key row. In other words, details for a <code>nation</code> must be added before any data about its listed stocks are entered.</p>
<p>Every foreign key must have a matching primary key (referential integrity rule), and every primary key must be non-null (entity integrity rule). A foreign key cannot be null when a relationship is mandatory, as in the case where a stock must belong to a nation. If a relationship is optional (a person can have a boss), then a foreign key can be null (i.e., a person is the head of the organization, and thus has no boss). The ideas of mandatory and optional will be discussed later in this book.</p>
<p>Why is the foreign key in the table at the “many” end of the relationship? Because each instance of <code>stock</code> is associated with exactly one instance of <code>nation</code>. The rule is that a <code>stock</code> must be listed in one, and only one, nation. Thus, the foreign key field is single-valued when it is at the “many” end of a relationship. The foreign key is not at the “one” end of the relationship because each instance of nation can be associated with more than one instance of <code>stock</code>, and this implies a multivalued foreign key. The relational model does not support multivalued fields.</p>
</div>
</div>
<div id="mysql-workbench" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> MySQL Workbench<a href="the-one-to-many-relationship.html#mysql-workbench" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In Workbench, a 1:m relationship is represented in a similar manner to the method you have just learned. Also, note that the foreign key is shown in the entity at the many end with a red diamond. We omit the foreign key when data modeling because it can be inferred.</p>
<p><em>Specifying a 1:m relationship in MySQL Workbench</em></p>
<p><img src="Figures/Chapter%204/wb-stock-nation.png" /></p>
</div>
</div>
<div id="querying-a-two-table-database" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Querying a two-table database<a href="the-one-to-many-relationship.html#querying-a-two-table-database" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A two-table database offers the opportunity to learn more SQL and another relational algebra operation: join.</p>
<div id="join" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Join<a href="the-one-to-many-relationship.html#join" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Join creates a new table from two existing tables by matching on a column common to both tables. Usually, the common column is a primary key–foreign key pair: The primary key of one table is matched with the foreign key of another table. Join is frequently used to get the data for a query into a single row. Consider the tables <code>nation</code> and <code>stock</code>. If we want to calculate the value—in British pounds—of a stock, we multiply stock price by stock quantity and then exchange rate. To find the appropriate exchange rate for a stock, get its <code>natcode</code> from stock and then find the exchange rate in the matching row in <code>nation</code>, the one with the same value for <code>natcode</code>. For example, to calculate the value of Georgia Peach, which has <code>natcode</code> = ‘US’, find the row in <code>nation</code> that also has <code>natcode</code> = ‘US’. In this case, the stock’s value is 2.35 * 387333 / 0.67 = £609,855.81.</p>
<p>Calculation of stock value is very easy once a join is used to get the three values in one row. The SQL command for joining the two tables is:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb30-1"><a href="the-one-to-many-relationship.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation</span>
<span id="cb30-2"><a href="the-one-to-many-relationship.html#cb30-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-30">Table 2.1: </span>Displaying records 1 - 10</caption>
<colgroup>
<col width="8%" />
<col width="19%" />
<col width="9%" />
<col width="7%" />
<col width="7%" />
<col width="6%" />
<col width="8%" />
<col width="8%" />
<col width="15%" />
<col width="9%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">stkcode</th>
<th align="left">stkfirm</th>
<th align="right">stkprice</th>
<th align="right">stkqty</th>
<th align="right">stkdiv</th>
<th align="right">stkpe</th>
<th align="left">natcode</th>
<th align="left">natcode</th>
<th align="left">natname</th>
<th align="right">exchrate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">IR</td>
<td align="left">Indooroopilly Ruby</td>
<td align="right">15.92</td>
<td align="right">56147</td>
<td align="right">0.50</td>
<td align="right">20</td>
<td align="left">AUS</td>
<td align="left">AUS</td>
<td align="left">Australia</td>
<td align="right">0.4600</td>
</tr>
<tr class="even">
<td align="left">NE</td>
<td align="left">Narembeen Emu</td>
<td align="right">12.34</td>
<td align="right">45619</td>
<td align="right">1.00</td>
<td align="right">8</td>
<td align="left">AUS</td>
<td align="left">AUS</td>
<td align="left">Australia</td>
<td align="right">0.4600</td>
</tr>
<tr class="odd">
<td align="left">QD</td>
<td align="left">Queensland Diamond</td>
<td align="right">6.73</td>
<td align="right">89251</td>
<td align="right">0.50</td>
<td align="right">7</td>
<td align="left">AUS</td>
<td align="left">AUS</td>
<td align="left">Australia</td>
<td align="right">0.4600</td>
</tr>
<tr class="even">
<td align="left">BD</td>
<td align="left">Bombay Duck</td>
<td align="right">25.55</td>
<td align="right">167382</td>
<td align="right">1.00</td>
<td align="right">12</td>
<td align="left">IND</td>
<td align="left">IND</td>
<td align="left">India</td>
<td align="right">0.0228</td>
</tr>
<tr class="odd">
<td align="left">AR</td>
<td align="left">Abyssinian Ruby</td>
<td align="right">31.82</td>
<td align="right">22010</td>
<td align="right">1.32</td>
<td align="right">13</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="even">
<td align="left">BE</td>
<td align="left">Burmese Elephant</td>
<td align="right">0.07</td>
<td align="right">154713</td>
<td align="right">0.01</td>
<td align="right">3</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="odd">
<td align="left">BS</td>
<td align="left">Bolivian Sheep</td>
<td align="right">12.75</td>
<td align="right">231678</td>
<td align="right">1.78</td>
<td align="right">11</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="even">
<td align="left">CS</td>
<td align="left">Canadian Sugar</td>
<td align="right">52.78</td>
<td align="right">4716</td>
<td align="right">2.50</td>
<td align="right">15</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="odd">
<td align="left">FC</td>
<td align="left">Freedonia Copper</td>
<td align="right">27.50</td>
<td align="right">10529</td>
<td align="right">1.84</td>
<td align="right">16</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
<tr class="even">
<td align="left">ILZ</td>
<td align="left">Indian Lead &amp; Zinc</td>
<td align="right">37.75</td>
<td align="right">6390</td>
<td align="right">3.00</td>
<td align="right">12</td>
<td align="left">UK</td>
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
</tbody>
</table>
</div>
<p><em>The join of stock and nation</em></p>
<p>The columns <code>stkprice</code> and <code>stkdiv</code> record values in the country’s currency. Thus, the price of Bombay Duck is 25.55 Indian rupees. To find the value in U.K. pounds (GPB), multiply the price by 0.0228, because one rupee is worth 0.0228 GPB. The value of one share of Bombay Duck in U.S. dollars (USD) is 25.55 * 0.0228 / 0.67 because one USD is worth 0.67 GBP.</p>
<p>There are several things to notice about the SQL command and the result:</p>
<ul>
<li><p>To avoid confusion because <code>natcode</code> is a column name in both stock and nation, it needs to be qualified. If <code>natcode</code> is not qualified, the system will reject the query because it cannot distinguish between the two columns titled <code>natcode</code>.</p></li>
<li><p>The new table has the <code>natcode</code> column replicated. Both are called <code>natcode</code>. The naming convention for the replicated column varies with the RDBMS. The columns, for example, should be labeled <code>stock.natcode</code> and <code>nation.natcode</code>.</p></li>
<li><p>The SQL command specifies the names of the tables to be joined, the columns to be used for matching, and the condition for the match (equality in this case).</p></li>
<li><p>The number of columns in the new table is the sum of the columns in the two tables.</p></li>
<li><p>The stock value calculation is now easily specified in an SQL command because all the data are in one row.</p></li>
</ul>
<p>Remember that during data modeling we created two entities, STOCK and NATION, and defined the relationship between them. We showed that if the data were stored in one table, there could be updating problems. Now, with a join, we have combined these data. So why separate the data only to put them back together later? There are two reasons. First, we want to avoid update anomalies. Second, as you will discover, we do not join the same tables every time.</p>
<p>A join can be combined with other SQL commands.</p>
<p><em>Report the value of each stockholding in UK pounds. Sort the report by nation and firm.</em></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb31-1"><a href="the-one-to-many-relationship.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname, stkfirm, stkprice, stkqty, exchrate,</span>
<span id="cb31-2"><a href="the-one-to-many-relationship.html#cb31-2" aria-hidden="true" tabindex="-1"></a>    stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate <span class="kw">as</span> stkvalue</span>
<span id="cb31-3"><a href="the-one-to-many-relationship.html#cb31-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation</span>
<span id="cb31-4"><a href="the-one-to-many-relationship.html#cb31-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb31-5"><a href="the-one-to-many-relationship.html#cb31-5" aria-hidden="true" tabindex="-1"></a>                <span class="kw">ORDER</span> <span class="kw">BY</span> natname, stkfirm;</span></code></pre></div>
<div class="knitsql-table">
<table style="width:100%;">
<caption><span id="tab:unnamed-chunk-31">Table 2.2: </span>Displaying records 1 - 10</caption>
<colgroup>
<col width="21%" />
<col width="27%" />
<col width="12%" />
<col width="10%" />
<col width="12%" />
<col width="15%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="left">stkfirm</th>
<th align="right">stkprice</th>
<th align="right">stkqty</th>
<th align="right">exchrate</th>
<th align="right">stkvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="left">Indooroopilly Ruby</td>
<td align="right">15.92</td>
<td align="right">56147</td>
<td align="right">0.4600</td>
<td align="right">411175.71</td>
</tr>
<tr class="even">
<td align="left">Australia</td>
<td align="left">Narembeen Emu</td>
<td align="right">12.34</td>
<td align="right">45619</td>
<td align="right">0.4600</td>
<td align="right">258951.69</td>
</tr>
<tr class="odd">
<td align="left">Australia</td>
<td align="left">Queensland Diamond</td>
<td align="right">6.73</td>
<td align="right">89251</td>
<td align="right">0.4600</td>
<td align="right">276303.25</td>
</tr>
<tr class="even">
<td align="left">India</td>
<td align="left">Bombay Duck</td>
<td align="right">25.55</td>
<td align="right">167382</td>
<td align="right">0.0228</td>
<td align="right">97506.71</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Abyssinian Ruby</td>
<td align="right">31.82</td>
<td align="right">22010</td>
<td align="right">1.0000</td>
<td align="right">700358.20</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Bolivian Sheep</td>
<td align="right">12.75</td>
<td align="right">231678</td>
<td align="right">1.0000</td>
<td align="right">2953894.50</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Burmese Elephant</td>
<td align="right">0.07</td>
<td align="right">154713</td>
<td align="right">1.0000</td>
<td align="right">10829.91</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Canadian Sugar</td>
<td align="right">52.78</td>
<td align="right">4716</td>
<td align="right">1.0000</td>
<td align="right">248910.48</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Freedonia Copper</td>
<td align="right">27.50</td>
<td align="right">10529</td>
<td align="right">1.0000</td>
<td align="right">289547.50</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Indian Lead &amp; Zinc</td>
<td align="right">37.75</td>
<td align="right">6390</td>
<td align="right">1.0000</td>
<td align="right">241222.50</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="group-byreporting-by-groups" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> GROUP BY—reporting by groups<a href="the-one-to-many-relationship.html#group-byreporting-by-groups" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The GROUP BY clause is an elementary form of control break reporting. It permits grouping of rows that have the same value for a specified column or columns, and it produces one row for each different value of the grouping column(s).</p>
<p><em>Report by nation the total value of stockholdings.</em></p>
<div class="sourceCode" id="cb32"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb32-1"><a href="the-one-to-many-relationship.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname, <span class="fu">sum</span>(stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate) <span class="kw">as</span> stkvalue</span>
<span id="cb32-2"><a href="the-one-to-many-relationship.html#cb32-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb32-3"><a href="the-one-to-many-relationship.html#cb32-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">GROUP</span> <span class="kw">BY</span> natname;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-32">Table 2.3: </span>4 records</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="right">stkvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">946430.65</td>
</tr>
<tr class="even">
<td align="left">India</td>
<td align="right">97506.71</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">48908364.25</td>
</tr>
<tr class="even">
<td align="left">United States</td>
<td align="right">30066065.54</td>
</tr>
</tbody>
</table>
</div>
<p>SQL’s built-in functions (COUNT, SUM, AVERAGE, MIN, and MAX) can be used with the GROUP BY clause. They are applied to a group of rows having the same value for a specified column. You can specify more than one function in a SELECT statement. For example, we can compute total value and number of different stocks and group by nation using:</p>
<p><em>Report the number of stocks and their total value by nation.</em></p>
<div class="sourceCode" id="cb33"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb33-1"><a href="the-one-to-many-relationship.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname, <span class="fu">COUNT</span>(<span class="op">*</span>), <span class="fu">SUM</span>(stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate) <span class="kw">AS</span> stkvalue</span>
<span id="cb33-2"><a href="the-one-to-many-relationship.html#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb33-3"><a href="the-one-to-many-relationship.html#cb33-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">GROUP</span> <span class="kw">BY</span> natname;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-33">Table 2.4: </span>4 records</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="right">COUNT(*)</th>
<th align="right">stkvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">3</td>
<td align="right">946430.65</td>
</tr>
<tr class="even">
<td align="left">India</td>
<td align="right">1</td>
<td align="right">97506.71</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">10</td>
<td align="right">48908364.25</td>
</tr>
<tr class="even">
<td align="left">United States</td>
<td align="right">2</td>
<td align="right">30066065.54</td>
</tr>
</tbody>
</table>
</div>
<p>You can group by more than one column name; however, all column names appearing in the SELECT clause must be associated with a built-in function or be in a GROUP BY clause.</p>
<p><em>List stocks by nation, and for each nation show the number of stocks for each PE ratio and the total value of those stock holdings in UK pounds.</em></p>
<div class="sourceCode" id="cb34"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb34-1"><a href="the-one-to-many-relationship.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname,stkpe,<span class="fu">COUNT</span>(<span class="op">*</span>),</span>
<span id="cb34-2"><a href="the-one-to-many-relationship.html#cb34-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">SUM</span>(stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate) <span class="kw">AS</span> stkvalue</span>
<span id="cb34-3"><a href="the-one-to-many-relationship.html#cb34-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb34-4"><a href="the-one-to-many-relationship.html#cb34-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">GROUP</span> <span class="kw">BY</span> natname, stkpe;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-34">Table 2.5: </span>Displaying records 1 - 14</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="right">stkpe</th>
<th align="right">COUNT(*)</th>
<th align="right">stkvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">20</td>
<td align="right">1</td>
<td align="right">411175.71</td>
</tr>
<tr class="even">
<td align="left">Australia</td>
<td align="right">8</td>
<td align="right">1</td>
<td align="right">258951.69</td>
</tr>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">7</td>
<td align="right">1</td>
<td align="right">276303.25</td>
</tr>
<tr class="even">
<td align="left">India</td>
<td align="right">12</td>
<td align="right">1</td>
<td align="right">97506.71</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">13</td>
<td align="right">1</td>
<td align="right">700358.20</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">10829.91</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">11</td>
<td align="right">1</td>
<td align="right">2953894.50</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="right">15</td>
<td align="right">1</td>
<td align="right">248910.48</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">16</td>
<td align="right">2</td>
<td align="right">1945108.66</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="right">12</td>
<td align="right">1</td>
<td align="right">241222.50</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="right">10</td>
<td align="right">2</td>
<td align="right">1129388.75</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="right">6</td>
<td align="right">1</td>
<td align="right">41678651.25</td>
</tr>
<tr class="odd">
<td align="left">United States</td>
<td align="right">5</td>
<td align="right">1</td>
<td align="right">609855.81</td>
</tr>
<tr class="even">
<td align="left">United States</td>
<td align="right">25</td>
<td align="right">1</td>
<td align="right">29456209.73</td>
</tr>
</tbody>
</table>
</div>
<p>In this example, stocks are grouped by both <code>natname</code> and <code>stkpe</code>. In most cases, there is only one stock for each pair of <code>natname</code> and <code>stkpe</code>; however, there are two situations (U.K. stocks with PEs of 10 and 16) where details of multiple stocks are grouped into one report line. Examining the values in the COUNT column helps you to identify these stocks.</p>
</div>
<div id="havingthe-where-clause-of-groups" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> HAVING—the WHERE clause of groups<a href="the-one-to-many-relationship.html#havingthe-where-clause-of-groups" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The HAVING clause in a GROUP BY is like the WHERE clause in a SELECT. It restricts the number of groups reported, whereas WHERE restricts the number of rows reported. Used with built-in functions, HAVING is always preceded by GROUP BY and is always followed by a function (SUM, AVG, MAX, MIN, or COUNT).</p>
<p><em>Report the total value of stocks for nations with two or more listed stocks.</em></p>
<div class="sourceCode" id="cb35"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb35-1"><a href="the-one-to-many-relationship.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname, <span class="fu">SUM</span>(stkprice<span class="op">*</span>stkqty<span class="op">*</span>exchrate) <span class="kw">AS</span> stkvalue</span>
<span id="cb35-2"><a href="the-one-to-many-relationship.html#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb35-3"><a href="the-one-to-many-relationship.html#cb35-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">GROUP</span> <span class="kw">BY</span> natname</span>
<span id="cb35-4"><a href="the-one-to-many-relationship.html#cb35-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">HAVING</span> <span class="fu">COUNT</span>(<span class="op">*</span>) <span class="op">&gt;=</span> <span class="dv">2</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-35">Table 2.6: </span>3 records</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="right">stkvalue</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="right">946430.6</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="right">48908364.2</td>
</tr>
<tr class="odd">
<td align="left">United States</td>
<td align="right">30066065.5</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>❓ <em>Skill builder</em></p>
<p>Report by nation the total value of dividends.</p>
</blockquote>
</div>
</div>
<div id="regular-expressionpattern-matching-1" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Regular expression—pattern matching<a href="the-one-to-many-relationship.html#regular-expressionpattern-matching-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Regular expression was introduced in the previous chapter, and we will now continue to learn some more of its features.</p>
<div id="search-for-a-string-not-containing-specified-characters" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Search for a string not containing specified characters<a href="the-one-to-many-relationship.html#search-for-a-string-not-containing-specified-characters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The ^ (carat) is the symbol for NOT. It is used when we want to find a string not containing a character in one or more specified strings. For example, [^a-f] means any character not in the set containing a, b, c, d, e, or f.</p>
<p><em>List the names of nations with non-alphabetic characters in their names</em></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb36-1"><a href="the-one-to-many-relationship.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname <span class="kw">FROM</span> nation <span class="kw">WHERE</span> natname REGEXP <span class="st">&#39;[^a-z|A-Z]&#39;</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-36">Table 2.7: </span>2 records</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">United Kingdom</td>
</tr>
<tr class="even">
<td align="left">United States</td>
</tr>
</tbody>
</table>
</div>
<p>Notice that the nations reported have a space in their name, which is a character not in the range a-z and not in A-Z.</p>
</div>
<div id="search-for-string-containing-a-repeated-pattern-or-repetition" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Search for string containing a repeated pattern or repetition<a href="the-one-to-many-relationship.html#search-for-string-containing-a-repeated-pattern-or-repetition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A pair of curly brackets is used to denote the repetition factor for a pattern. For example, {n} means repeat a specified pattern n times.</p>
<p><em>List the names of firms with a double ‘e’.</em></p>
<div class="sourceCode" id="cb37"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb37-1"><a href="the-one-to-many-relationship.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock <span class="kw">WHERE</span> stkfirm REGEXP <span class="st">&#39;[e]{2}&#39;</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-37">Table 2.8: </span>5 records</caption>
<thead>
<tr class="header">
<th align="left">stkfirm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Bolivian Sheep</td>
</tr>
<tr class="even">
<td align="left">Freedonia Copper</td>
</tr>
<tr class="odd">
<td align="left">Narembeen Emu</td>
</tr>
<tr class="even">
<td align="left">Nigerian Geese</td>
</tr>
<tr class="odd">
<td align="left">Queensland Diamond</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="search-combining-alternation-and-repetition" class="section level3 hasAnchor" number="2.3.3">
<h3><span class="header-section-number">2.3.3</span> Search combining alternation and repetition<a href="the-one-to-many-relationship.html#search-combining-alternation-and-repetition" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Regular expressions becomes very powerful when you combine several of the basic capabilities into a single search expression.</p>
<p><em>List the names of firms with a double ‘s’ or a double ‘n’.</em></p>
<div class="sourceCode" id="cb38"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb38-1"><a href="the-one-to-many-relationship.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock <span class="kw">WHERE</span> stkfirm REGEXP <span class="st">&#39;[s]{2}|[n]{2}&#39;</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-38">Table 2.9: </span>2 records</caption>
<thead>
<tr class="header">
<th align="left">stkfirm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Abyssinian Ruby</td>
</tr>
<tr class="even">
<td align="left">Minnesota Gold</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="search-for-multiple-versions-of-a-string" class="section level3 hasAnchor" number="2.3.4">
<h3><span class="header-section-number">2.3.4</span> Search for multiple versions of a string<a href="the-one-to-many-relationship.html#search-for-multiple-versions-of-a-string" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you are interested in find a string containing several specified string, you can use the square brackets to indicate the sought strings. For example, [ea] means any character from the set containing e and a.</p>
<p><em>List the names of firms with names that include ‘inia’ or ‘onia’.</em></p>
<div class="sourceCode" id="cb39"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb39-1"><a href="the-one-to-many-relationship.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock <span class="kw">WHERE</span> stkfirm REGEXP <span class="st">&#39;[io]nia&#39;</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-39">Table 2.10: </span>3 records</caption>
<thead>
<tr class="header">
<th align="left">stkfirm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Abyssinian Ruby</td>
</tr>
<tr class="even">
<td align="left">Freedonia Copper</td>
</tr>
<tr class="odd">
<td align="left">Patagonian Tea</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="search-for-a-string-in-a-particular-position" class="section level3 hasAnchor" number="2.3.5">
<h3><span class="header-section-number">2.3.5</span> Search for a string in a particular position<a href="the-one-to-many-relationship.html#search-for-a-string-in-a-particular-position" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sometimes you might be interested in identifying a string with a character in a particular position.</p>
<p><em>Find firms with ‘t’ as the third letter of their name.</em></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb40-1"><a href="the-one-to-many-relationship.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock <span class="kw">WHERE</span> stkfirm REGEXP <span class="st">&#39;^(.){2}t&#39;</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-40">Table 2.11: </span>1 records</caption>
<thead>
<tr class="header">
<th align="left">stkfirm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Patagonian Tea</td>
</tr>
</tbody>
</table>
</div>
<p>The regular expression has three elements:</p>
<ul>
<li><p>^ indicates start searching at the beginning of the string;</p></li>
<li><p>(.){2} specifies that anything is acceptable for the next two characters;</p></li>
<li><p>t indicates what the next character, the third, must be.</p></li>
</ul>
</div>
<div id="search-for-a-string-not-containing-any-specified-characters" class="section level3 hasAnchor" number="2.3.6">
<h3><span class="header-section-number">2.3.6</span> Search for a string not containing any specified characters<a href="the-one-to-many-relationship.html#search-for-a-string-not-containing-any-specified-characters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There might be a need to find rows not containing specified characters anywhere in a givev coumn. You need to check every character in the string to ensure there are matches.</p>
<p><em>List the names of nations without s or S <strong>anywhere</strong> in their names</em></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb41-1"><a href="the-one-to-many-relationship.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> nation <span class="kw">WHERE</span> natname REGEXP <span class="st">&#39;^[^s|S]*$&#39;</span></span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-41">Table 2.12: </span>2 records</caption>
<thead>
<tr class="header">
<th align="left">natcode</th>
<th align="left">natname</th>
<th align="right">exchrate</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">IND</td>
<td align="left">India</td>
<td align="right">0.0228</td>
</tr>
<tr class="even">
<td align="left">UK</td>
<td align="left">United Kingdom</td>
<td align="right">1.0000</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li>^ start searching at the beginning of the string;</li>
<li>$ end searching at the end of the string;</li>
<li>* any character in a string;</li>
<li>^s|S no lower or upper case s.</li>
</ul>
<p>You have seen a few of the features of a very powerful tool. To learn more about regular expressions, see <a href="http://regexlib.com">regexlib.com</a>, which contains a library of regular expressions and a feature for finding expressions to solve specific problems. Check out the regular expression for checking whether a character string is a valid email address.</p>
</div>
</div>
<div id="subqueries-1" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Subqueries<a href="the-one-to-many-relationship.html#subqueries-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A subquery, or nested SELECT, is a SELECT nested within another SELECT. A subquery can be used to return a list of values subsequently searched with an IN clause.</p>
<p><em>Report the names of all Australian stocks.</em></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb42-1"><a href="the-one-to-many-relationship.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock</span>
<span id="cb42-2"><a href="the-one-to-many-relationship.html#cb42-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> natcode <span class="kw">IN</span></span>
<span id="cb42-3"><a href="the-one-to-many-relationship.html#cb42-3" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">SELECT</span> natcode <span class="kw">FROM</span> nation</span>
<span id="cb42-4"><a href="the-one-to-many-relationship.html#cb42-4" aria-hidden="true" tabindex="-1"></a>            <span class="kw">WHERE</span> natname <span class="op">=</span> <span class="st">&#39;Australia&#39;</span>);</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-42">Table 2.13: </span>3 records</caption>
<thead>
<tr class="header">
<th align="left">stkfirm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Indooroopilly Ruby</td>
</tr>
<tr class="even">
<td align="left">Narembeen Emu</td>
</tr>
<tr class="odd">
<td align="left">Queensland Diamond</td>
</tr>
</tbody>
</table>
</div>
<p>Conceptually, the subquery is evaluated first. It returns a list of values for natcode (‘AUS’) so that the query then is the same as:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb43-1"><a href="the-one-to-many-relationship.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock</span>
<span id="cb43-2"><a href="the-one-to-many-relationship.html#cb43-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> natcode <span class="kw">IN</span> (<span class="st">&#39;AUS&#39;</span>);</span></code></pre></div>
<p>When discussing subqueries, sometimes a subquery is also called an <strong>inner query</strong>. The term <strong>outer query</strong> is applied to the SQL preceding the inner query. In this case, the outer and inner queries are:</p>
<table>
<colgroup>
<col width="21%" />
<col width="78%" />
</colgroup>
<tbody>
<tr class="odd">
<td>Outer query</td>
<td>SELECT stkfirm FROM stock WHERE natcode IN</td>
</tr>
<tr class="even">
<td>Inner query</td>
<td>(SELECT natcode FROM nation WHERE natname = ‘Australia’);</td>
</tr>
</tbody>
</table>
<p>Note that in this case we do not have to qualify <code>natcode</code>. There is no identity crisis, because <code>natcode</code> in the inner query is implicitly qualified as <code>nation.natcode</code> and <code>natcode</code> in the outer query is understood to be <code>stock.natcode</code>.</p>
<p>This query also can be run as a join by writing:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb44-1"><a href="the-one-to-many-relationship.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> stkfirm <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation</span>
<span id="cb44-2"><a href="the-one-to-many-relationship.html#cb44-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb44-3"><a href="the-one-to-many-relationship.html#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> natname <span class="op">=</span> <span class="st">&#39;Australia&#39;</span>;</span></code></pre></div>
<div id="correlated-subquery" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Correlated subquery<a href="the-one-to-many-relationship.html#correlated-subquery" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In a correlated subquery, the subquery cannot be evaluated independently of the outer query. It depends on the outer query for the values it needs to resolve the inner query. The subquery is evaluated for each value passed to it by the outer query. An example illustrates when you might use a correlated subquery and how it operates.</p>
<p><em>Find those stocks where the quantity is greater than the average for that country.</em></p>
<p>An approach to this query is to examine the rows of stock one a time, and each time compare the quantity of stock to the average for that country. This means that for each row, the subquery must receive the outer query’s country code so it can compute the average for that country.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb45-1"><a href="the-one-to-many-relationship.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> natname, stkfirm, stkqty <span class="kw">FROM</span> stock <span class="kw">JOIN</span> nation</span>
<span id="cb45-2"><a href="the-one-to-many-relationship.html#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> stock.natcode <span class="op">=</span> nation.natcode</span>
<span id="cb45-3"><a href="the-one-to-many-relationship.html#cb45-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> stkqty <span class="op">&gt;</span></span>
<span id="cb45-4"><a href="the-one-to-many-relationship.html#cb45-4" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">SELECT</span> <span class="fu">avg</span>(stkqty) <span class="kw">FROM</span> stock</span>
<span id="cb45-5"><a href="the-one-to-many-relationship.html#cb45-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">WHERE</span> stock.natcode <span class="op">=</span> nation.natcode);</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-45">Table 2.14: </span>4 records</caption>
<thead>
<tr class="header">
<th align="left">natname</th>
<th align="left">stkfirm</th>
<th align="right">stkqty</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Australia</td>
<td align="left">Queensland Diamond</td>
<td align="right">89251</td>
</tr>
<tr class="even">
<td align="left">United Kingdom</td>
<td align="left">Bolivian Sheep</td>
<td align="right">231678</td>
</tr>
<tr class="odd">
<td align="left">United Kingdom</td>
<td align="left">Royal Ostrich Farms</td>
<td align="right">1234923</td>
</tr>
<tr class="even">
<td align="left">United States</td>
<td align="left">Minnesota Gold</td>
<td align="right">816122</td>
</tr>
</tbody>
</table>
</div>
<p>Conceptually, think of this query as stepping through the join of <code>stock</code> and <code>nation</code> one row at a time and executing the subquery each time. The first row has <code>natcode</code> = ‘AUS’ so the subquery becomes</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb46-1"><a href="the-one-to-many-relationship.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">AVG</span>(stkqty) <span class="kw">FROM</span> stock</span>
<span id="cb46-2"><a href="the-one-to-many-relationship.html#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> stock.natcode <span class="op">=</span> <span class="st">&#39;AUS&#39;</span>;</span></code></pre></div>
<p>Since the average stock quantity for Australian stocks is 63,672.33, the first row in the join, Narembeen Emu, is not reported. Neither is the second row reported, but the third is.</p>
<p>The term <strong>correlated subquery</strong> is used because the inner query’s execution depends on receiving a value for a variable (<code>nation.natcode</code> in this instance) from the outer query. Thus, the inner query of the correlated subquery cannot be evaluated once and for all. It must be evaluated repeatedly—once for each value of the variable received from the outer query. In this respect, a correlated subquery is different from a subquery, where the inner query needs to be evaluated only once. The requirement to compare each row of a table against a function (e.g., average or count) for some rows of a column is usually a clue that you need to write a correlated subquery.</p>
<blockquote>
<p>❓ <em>Skill builder</em></p>
<p>Why are no Indian stocks reported in the correlated subquery example? How would you change the query to report an Indian stock?
Report only the three stocks with the largest quantities (i.e., do the query without using ORDER BY).</p>
</blockquote>
</div>
</div>
<div id="summary-1" class="section level2 unnumbered hasAnchor">
<h2>Summary<a href="the-one-to-many-relationship.html#summary-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Entities are related to other entities by relationships. The 1:m (one-to-many) relationship occurs frequently in data models. An additional entity is required to represent a 1:m relationship to avoid update anomalies. In a relational database, a 1:m relationship is represented by an additional column, the foreign key, in the table at the many end of the relationship. The referential integrity constraint insists that a foreign key must always exist as a primary key in a table. A foreign key constraint is specified in a CREATE statement.</p>
<p>Join creates a new table from two existing tables by matching on a column common to both tables. Often the common column is a primary key–foreign key combination. The GROUP BY clause is used to create an elementary control break report. The HAVING clause of GROUP BY is like the WHERE clause of SELECT. A subquery, which has a SELECT statement within another SELECT statement, causes two SELECT statements to be executed—one for the inner query and one for the outer query.</p>
</div>
<div id="key-terms-and-concepts-1" class="section level2 unnumbered hasAnchor">
<h2>Key terms and concepts<a href="the-one-to-many-relationship.html#key-terms-and-concepts-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<tbody>
<tr class="odd">
<td align="left">Constraint</td>
<td align="left">JOIN</td>
</tr>
<tr class="even">
<td align="left">Control break reporting</td>
<td align="left">One-to-many (1:m) relationship</td>
</tr>
<tr class="odd">
<td align="left">Correlated subquery</td>
<td align="left">Referential integrity</td>
</tr>
<tr class="even">
<td align="left">Delete anomalies</td>
<td align="left">Relationship</td>
</tr>
<tr class="odd">
<td align="left">Foreign key</td>
<td align="left">Update anomalies</td>
</tr>
<tr class="even">
<td align="left">GROUP BY</td>
<td align="left">HAVING</td>
</tr>
<tr class="odd">
<td align="left">Insert anomalies</td>
<td align="left"></td>
</tr>
</tbody>
</table>
</div>
<div id="exercises-1" class="section level2 unnumbered hasAnchor">
<h2>Exercises<a href="the-one-to-many-relationship.html#exercises-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- 1.  Draw data models for the following situations. In each case, make certain that you show the attributes and feasible identifiers: -->
<!--     a.  A farmer can have many cows, but a cow belongs to only one farmer. -->
<!--     b.  A university has many students, and a student can attend at most one university. -->
<!--     c.  An aircraft can have many passengers, but a passenger can be on only one flight at a time. -->
<!--     d.  A nation can have many states and a state many cities. -->
<!--     e.  An art researcher has asked you to design a database to record details of artists and the museums in which their paintings are displayed. For each painting, the researcher wants to know the size of the canvas, year painted, title, and style. The nationality, date of birth, and death of each artist must be recorded. For each museum, record details of its location and specialty, if it has one. -->
<ol start="2" style="list-style-type: decimal">
<li><p>Report all values in British pounds:</p>
<ol style="list-style-type: lower-alpha">
<li><p>Report the value of stocks listed in Australia.</p></li>
<li><p>Report the dividend payment of all stocks.</p></li>
<li><p>Report the total dividend payment by nation.</p></li>
<li><p>Create a view containing nation, firm, price, quantity, exchange rate, value, and yield.</p></li>
<li><p>Report the average yield by nation.</p></li>
<li><p>Report the minimum and maximum yield for each nation.</p></li>
<li><p>Report the nations where the average yield of stocks exceeds the average yield of all stocks.</p></li>
</ol></li>
<li><p>How would you change the queries in exercise 4-2 if you were required to report the values in American dollars, Australian dollars, or Indian rupees?</p></li>
</ol>
<!-- 4.  What is a foreign key and what role does it serve? -->
<!-- 5.  What is the referential integrity constraint? Why should it be enforced? -->
<!-- 6.  Kisha, against the advice of her friends, is simultaneously studying data management and Shakespearean drama. She thought the two subjects would be an interesting contrast. However, the classes are very demanding and often enter her midsummer dreams. Last night, she dreamed that William Shakespeare wanted her to draw a data model. He explained, before she woke up in a cold sweat, that a play had many characters but the same character never appeared in more than one play. "Methinks," he said, "the same name may have appeareth more than the once, but 'twas always a person of a different ilk." He then, she hazily recollects, went on to spout about the quality of data dropping like the gentle rain. Draw a data model to keep old Bill quiet and help Kisha get some sleep. -->
<!-- 7.  An orchestra has four broad classes of instruments (strings, woodwinds, brass, and percussion). Each class contains musicians who play different instruments. For example, the strings section of a full symphony orchestra contains 2 harps, 16 to 18 first violins, 14 to 16 second violins, 12 violas, 10 cellos, and 8 double basses. A city has asked you to develop a database to store details of the musicians in its three orchestras. All the musicians are specialists and play only one instrument for one orchestra. -->
<!-- ![](Figures/Chapter%204/person-car.png){width="335"} -->
<!-- 8.  Answer the following queries based on the following database for a car dealer: -->
<!--     a.  What is the personid of Sheila O'Hara? -->
<!--     b.  List sales personnel sorted by last name and within last name, first name. -->
<!--     c.  List details of the sales made by Bruce Bush. -->
<!--     d.  List details of all sales showing the gross profit (selling price minus cost price). -->
<!--     e.  Report the number of cars sold of each type. -->
<!--     f.  What is the average selling price of cars sold by Sue Lim? -->
<!--     g.  Report details of all sales where the gross profit is less than the average. -->
<!--     h.  What was the maximum selling price of any car? -->
<!--     i.  What is the total gross profit? -->
<!--     j.  Report the gross profit made by each salesperson who sold at least three cars. -->
<!--     k.  Create a view containing all the details in the car table and the gross profit -->
<ol start="9" style="list-style-type: decimal">
<li>Find stocks where the third or fourth letter in their name is an ‘m’.</li>
</ol>
<!-- 10. An electricity supply company needs a database to record details of solar panels installed on its customers' homes so it can estimate how much solar energy will be generated based on the forecast level of solar radiation for each house's location. A solar panel has an area, measured in square meters, and an efficiency expressed as a percentage (e.g., 22% efficiency means that 22% of the incident solar energy is converted into electrical energy). Create a data model. How will you identify each customer and each panel? -->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-single-entity.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="the-many-to-many-relationship.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/102-onetomany.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["DataManagement.pdf", "DataManagement.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
