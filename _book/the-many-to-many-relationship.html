<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 The Many-to-Many Relationship | DataManagement.knit</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 The Many-to-Many Relationship | DataManagement.knit" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 The Many-to-Many Relationship | DataManagement.knit" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="the-one-to-many-relationship.html"/>
<link rel="next" href="sql.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="data-management-databases-and-organizations.html"><a href="data-management-databases-and-organizations.html"><i class="fa fa-check"></i>Data Management: Databases and Organizations</a>
<ul>
<li class="chapter" data-level="" data-path="data-management-databases-and-organizations.html"><a href="data-management-databases-and-organizations.html#open-edition"><i class="fa fa-check"></i><em>Open Edition</em></a></li>
<li class="chapter" data-level="" data-path="data-management-databases-and-organizations.html"><a href="data-management-databases-and-organizations.html#richard-t.-watson"><i class="fa fa-check"></i>Richard T. Watson</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#supplements"><i class="fa fa-check"></i>Supplements</a></li>
<li class="chapter" data-level="" data-path="preface.html"><a href="preface.html#acknowledgments"><i class="fa fa-check"></i>Acknowledgments</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="section-1-introduction-to-sql.html"><a href="section-1-introduction-to-sql.html"><i class="fa fa-check"></i>Section 1 Introduction to SQL</a></li>
<li class="chapter" data-level="1" data-path="the-single-entity.html"><a href="the-single-entity.html"><i class="fa fa-check"></i><b>1</b> The Single Entity</a>
<ul>
<li class="chapter" data-level="1.1" data-path="the-single-entity.html"><a href="the-single-entity.html#the-relational-model"><i class="fa fa-check"></i><b>1.1</b> The relational model</a></li>
<li class="chapter" data-level="1.2" data-path="the-single-entity.html"><a href="the-single-entity.html#getting-started"><i class="fa fa-check"></i><b>1.2</b> Getting started</a></li>
<li class="chapter" data-level="1.3" data-path="the-single-entity.html"><a href="the-single-entity.html#modeling-a-single-entity-database"><i class="fa fa-check"></i><b>1.3</b> Modeling a single-entity database</a></li>
<li class="chapter" data-level="1.4" data-path="the-single-entity.html"><a href="the-single-entity.html#querying-a-single-table-database"><i class="fa fa-check"></i><b>1.4</b> Querying a single-table database</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="the-single-entity.html"><a href="the-single-entity.html#displaying-an-entire-table"><i class="fa fa-check"></i><b>1.4.1</b> Displaying an entire table</a></li>
<li class="chapter" data-level="1.4.2" data-path="the-single-entity.html"><a href="the-single-entity.html#projectchoosing-columns"><i class="fa fa-check"></i><b>1.4.2</b> Project—choosing columns</a></li>
<li class="chapter" data-level="1.4.3" data-path="the-single-entity.html"><a href="the-single-entity.html#restrictchoosing-rows"><i class="fa fa-check"></i><b>1.4.3</b> Restrict—choosing rows</a></li>
<li class="chapter" data-level="1.4.4" data-path="the-single-entity.html"><a href="the-single-entity.html#combining-project-and-restrictchoosing-rows-and-columns"><i class="fa fa-check"></i><b>1.4.4</b> Combining project and restrict—choosing rows and columns</a></li>
<li class="chapter" data-level="1.4.5" data-path="the-single-entity.html"><a href="the-single-entity.html#more-about-where"><i class="fa fa-check"></i><b>1.4.5</b> More about WHERE</a></li>
<li class="chapter" data-level="1.4.6" data-path="the-single-entity.html"><a href="the-single-entity.html#the-power-of-the-primary-key"><i class="fa fa-check"></i><b>1.4.6</b> The power of the primary key</a></li>
<li class="chapter" data-level="1.4.7" data-path="the-single-entity.html"><a href="the-single-entity.html#the-in-crowd"><i class="fa fa-check"></i><b>1.4.7</b> The IN crowd</a></li>
<li class="chapter" data-level="1.4.8" data-path="the-single-entity.html"><a href="the-single-entity.html#the-not-in-crowd"><i class="fa fa-check"></i><b>1.4.8</b> The NOT IN crowd</a></li>
<li class="chapter" data-level="1.4.9" data-path="the-single-entity.html"><a href="the-single-entity.html#ordering-columns"><i class="fa fa-check"></i><b>1.4.9</b> Ordering columns</a></li>
<li class="chapter" data-level="1.4.10" data-path="the-single-entity.html"><a href="the-single-entity.html#regular-expressionpattern-matching"><i class="fa fa-check"></i><b>1.4.10</b> Regular expression—pattern matching</a></li>
<li class="chapter" data-level="1.4.11" data-path="the-single-entity.html"><a href="the-single-entity.html#ordering-rows"><i class="fa fa-check"></i><b>1.4.11</b> Ordering rows</a></li>
<li class="chapter" data-level="1.4.12" data-path="the-single-entity.html"><a href="the-single-entity.html#numeric-versus-character-sorting"><i class="fa fa-check"></i><b>1.4.12</b> Numeric versus character sorting</a></li>
<li class="chapter" data-level="1.4.13" data-path="the-single-entity.html"><a href="the-single-entity.html#derived-data"><i class="fa fa-check"></i><b>1.4.13</b> Derived data</a></li>
<li class="chapter" data-level="1.4.14" data-path="the-single-entity.html"><a href="the-single-entity.html#aggregate-functions"><i class="fa fa-check"></i><b>1.4.14</b> Aggregate functions</a></li>
<li class="chapter" data-level="1.4.15" data-path="the-single-entity.html"><a href="the-single-entity.html#subqueries"><i class="fa fa-check"></i><b>1.4.15</b> Subqueries</a></li>
<li class="chapter" data-level="" data-path="the-single-entity.html"><a href="the-single-entity.html#quotes"><i class="fa fa-check"></i>Quotes</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-single-entity.html"><a href="the-single-entity.html#summary"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="the-single-entity.html"><a href="the-single-entity.html#key-terms-and-concepts"><i class="fa fa-check"></i>Key terms and concepts</a></li>
<li class="chapter" data-level="" data-path="the-single-entity.html"><a href="the-single-entity.html#exercises"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html"><i class="fa fa-check"></i><b>2</b> The One-to-Many Relationship</a>
<ul>
<li class="chapter" data-level="2.1" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#relationships"><i class="fa fa-check"></i><b>2.1</b> Relationships</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#why-did-we-create-an-additional-entity"><i class="fa fa-check"></i><b>2.1.1</b> Why did we create an additional entity?</a></li>
<li class="chapter" data-level="2.1.2" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#mysql-workbench"><i class="fa fa-check"></i><b>2.1.2</b> MySQL Workbench</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#querying-a-two-table-database"><i class="fa fa-check"></i><b>2.2</b> Querying a two-table database</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#join"><i class="fa fa-check"></i><b>2.2.1</b> Join</a></li>
<li class="chapter" data-level="2.2.2" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#group-byreporting-by-groups"><i class="fa fa-check"></i><b>2.2.2</b> GROUP BY—reporting by groups</a></li>
<li class="chapter" data-level="2.2.3" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#havingthe-where-clause-of-groups"><i class="fa fa-check"></i><b>2.2.3</b> HAVING—the WHERE clause of groups</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#regular-expressionpattern-matching-1"><i class="fa fa-check"></i><b>2.3</b> Regular expression—pattern matching</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-for-a-string-not-containing-specified-characters"><i class="fa fa-check"></i><b>2.3.1</b> Search for a string not containing specified characters</a></li>
<li class="chapter" data-level="2.3.2" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-for-string-containing-a-repeated-pattern-or-repetition"><i class="fa fa-check"></i><b>2.3.2</b> Search for string containing a repeated pattern or repetition</a></li>
<li class="chapter" data-level="2.3.3" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-combining-alternation-and-repetition"><i class="fa fa-check"></i><b>2.3.3</b> Search combining alternation and repetition</a></li>
<li class="chapter" data-level="2.3.4" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-for-multiple-versions-of-a-string"><i class="fa fa-check"></i><b>2.3.4</b> Search for multiple versions of a string</a></li>
<li class="chapter" data-level="2.3.5" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-for-a-string-in-a-particular-position"><i class="fa fa-check"></i><b>2.3.5</b> Search for a string in a particular position</a></li>
<li class="chapter" data-level="2.3.6" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#search-for-a-string-not-containing-any-specified-characters"><i class="fa fa-check"></i><b>2.3.6</b> Search for a string not containing any specified characters</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#subqueries-1"><i class="fa fa-check"></i><b>2.4</b> Subqueries</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#correlated-subquery"><i class="fa fa-check"></i><b>2.4.1</b> Correlated subquery</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#summary-1"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#key-terms-and-concepts-1"><i class="fa fa-check"></i>Key terms and concepts</a></li>
<li class="chapter" data-level="" data-path="the-one-to-many-relationship.html"><a href="the-one-to-many-relationship.html#exercises-1"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html"><i class="fa fa-check"></i><b>3</b> The Many-to-Many Relationship</a>
<ul>
<li class="chapter" data-level="" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#learning-objectives-2"><i class="fa fa-check"></i>Learning objectives</a></li>
<li class="chapter" data-level="3.1" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#the-many-to-many-relationship-1"><i class="fa fa-check"></i><b>3.1</b> The many-to-many relationship</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#mysql-workbench-1"><i class="fa fa-check"></i><b>3.1.1</b> MySQL Workbench</a></li>
<li class="chapter" data-level="3.1.2" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#why-did-we-create-a-third-entity"><i class="fa fa-check"></i><b>3.1.2</b> Why did we create a third entity?</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#querying-an-mm-relationship"><i class="fa fa-check"></i><b>3.2</b> Querying an m:m relationship</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#a-three-table-join"><i class="fa fa-check"></i><b>3.2.1</b> A three-table join</a></li>
<li class="chapter" data-level="3.2.2" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#existsdoes-a-value-exist"><i class="fa fa-check"></i><b>3.2.2</b> EXISTS—does a value exist</a></li>
<li class="chapter" data-level="3.2.3" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#not-existsselect-a-value-if-it-does-not-exist"><i class="fa fa-check"></i><b>3.2.3</b> NOT EXISTS—select a value if it does not exist</a></li>
<li class="chapter" data-level="" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#set-operations"><i class="fa fa-check"></i>Set operations</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#summary-2"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#key-terms-and-concepts-2"><i class="fa fa-check"></i>Key terms and concepts</a></li>
<li class="chapter" data-level="" data-path="the-many-to-many-relationship.html"><a href="the-many-to-many-relationship.html#exercises-2"><i class="fa fa-check"></i>Exercises</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="sql.html"><a href="sql.html"><i class="fa fa-check"></i><b>4</b> SQL</a>
<ul>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#learning-objectives-3"><i class="fa fa-check"></i>Learning objectives</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#structured-query-language"><i class="fa fa-check"></i>Structured query language</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#data-types"><i class="fa fa-check"></i>Data types</a>
<ul>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#boolean"><i class="fa fa-check"></i>BOOLEAN</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#smallint-and-integer"><i class="fa fa-check"></i>SMALLINT and INTEGER</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#float"><i class="fa fa-check"></i>FLOAT</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#decimal"><i class="fa fa-check"></i>DECIMAL</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#char-and-varchar"><i class="fa fa-check"></i>CHAR and VARCHAR</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#times-and-dates"><i class="fa fa-check"></i>Times and dates</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#blob-binary-large-object"><i class="fa fa-check"></i>BLOB (binary large object)</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#clob-character-large-object"><i class="fa fa-check"></i>CLOB (character large object)</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#scalar-functions"><i class="fa fa-check"></i>Scalar functions</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#formatting"><i class="fa fa-check"></i>Formatting</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#data-manipulation"><i class="fa fa-check"></i>Data manipulation</a>
<ul>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#qualifying-column-names"><i class="fa fa-check"></i>Qualifying column names</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#select"><i class="fa fa-check"></i>SELECT</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#product"><i class="fa fa-check"></i>Product</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#inner-join"><i class="fa fa-check"></i>Inner join</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#outer-join"><i class="fa fa-check"></i>Outer join</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#simple-subquery"><i class="fa fa-check"></i>Simple subquery</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#aggregate-functions-1"><i class="fa fa-check"></i>Aggregate functions</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#group-by-and-having"><i class="fa fa-check"></i>GROUP BY and HAVING</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#regexp"><i class="fa fa-check"></i>REGEXP</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#universal-unique-identifier-uuid"><i class="fa fa-check"></i>Universal Unique Identifier (UUID)</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#nullsmuch-ado-about-missing-information"><i class="fa fa-check"></i>Nulls—much ado about missing information</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#the-future-of-sql"><i class="fa fa-check"></i>The future of SQL</a>
<ul>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#summary-3"><i class="fa fa-check"></i>Summary</a></li>
<li class="chapter" data-level="" data-path="sql.html"><a href="sql.html#references-and-additional-readings"><i class="fa fa-check"></i>References and additional readings</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="the-many-to-many-relationship" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> The Many-to-Many Relationship<a href="the-many-to-many-relationship.html#the-many-to-many-relationship" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<blockquote>
<p><em>Fearful concatenation of circumstances.</em></p>
<p>Daniel Webster</p>
</blockquote>
<div id="learning-objectives-2" class="section level3 unnumbered hasAnchor">
<h3>Learning objectives<a href="the-many-to-many-relationship.html#learning-objectives-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Students completing this chapter will be able to</p>
<ul>
<li>model a many-to-many relationship between two entities;</li>
<li>define a database with a many-to-many relationship;</li>
<li>write queries for a database with a many-to-many relationship.</li>
</ul>
</div>
<div id="the-many-to-many-relationship-1" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> The many-to-many relationship<a href="the-many-to-many-relationship.html#the-many-to-many-relationship-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Consider the case when items are sold. We can immediately identify two entities: SALE and ITEM. A sale can contain many items, and an item can appear in many sales. We are not saying the same item can be sold many times, but the particular type of item (e.g., a compass) can be sold many times; thus we have a many-to-many (m:m) relationship between SALE and ITEM. When we have an m:m relationship, we create a third entity to link the entities through two 1:m relationships. Usually, it is fairly easy to name this third entity. In this case, this third entity, typically known as an <strong>associative entity</strong>, is called LINE ITEM. A typical old style sales form lists the items purchased by a customer. Each of the lines appearing on the order form is generally known in retailing as a line item, which links an item and a sale.</p>
<p><em>A sales form</em> <img src="Figures/Chapter%205/sales%20form.png" /></p>
<p>The representation of this m:m relationship is shown. We say many-to-many because there are two relationships—an ITEM is related to many SALEs, and a SALE is related to many ITEMs. This data model can also be read as: “a sale has many line items, but a line item refers to only one sale. Similarly, an item can appear as many line items, but a line item references only one item.”</p>
<p><em>An m:m relationship between SALE and ITEM</em></p>
<p><img src="Figures/Chapter%205/sale-item.png" width="566" /></p>
<p>The entity SALE is identified by <em>saleno</em> and has the attributes <em>saledate</em> and <em>saletext</em> (a brief comment on the customer—soft information). LINEITEM is partially identified by <em>lineno</em> and has attributes <em>lineqty</em> (the number of units sold) and <em>lineprice</em> (the unit selling price for this sale). ITEM is identified by <em>itemno</em> and has attributes <em>itemname</em>, <em>itemtype</em> (e.g., clothing, equipment, navigation aids, furniture, and so on), and <em>itemcolor</em>.</p>
<p>If you look carefully at the m:m relationship figure, you will notice that there is a plus sign (+) above the crow’s foot at the “many” end of the 1:m relationship between SALE and LINEITEM. This plus sign provides information about the identifier of LINEITEM. As you know, every entity must have a unique identifier. A sales order is a series of rows or lines, and <em>lineno</em> is unique only within a particular order. If we just use <em>lineno</em> as the identifier, we cannot guarantee that every instance of LINEITEM is unique. If we use <em>saleno</em> and <em>lineno</em> together, however, we have a unique identifier for every instance of LINEITEM. Identifier <em>saleno</em> is unique for every sale, and <em>lineno</em> is unique within any sale. The plus indicates that LINEITEM’s unique identifier is the concatenation of <em>saleno</em> and <em>lineno</em>. The order of concatenation does not matter.</p>
<p>LINEITEM is termed a <strong>weak entity</strong> because it relies on another entity for its existence and identification.</p>
<div id="mysql-workbench-1" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> MySQL Workbench<a href="the-many-to-many-relationship.html#mysql-workbench-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>An m:m relationship with Workbench</em></p>
<p><img src="Figures/Chapter%205/m-m-wb.png" /></p>
<p>Workbench distinguishes between two types of relationships. An <strong>identifying relationship</strong>, shown by a solid line, is used when the entity at the many end of the relationship is a weak entity and needs the identifier of the one end of the relationship to uniquely identify an instance of the relationship, as in LINEITEM. An identifying relationship corresponds to the + sign associated with a crow’s foot. The other type of relationship, shown by a dashed line, is known as a <em>non-identifying</em> relationship. The mapping between the type of relationship and the representation (i.e., dashed or solid line) is arbitrary and thus not always easily recalled. We think that using a + on the crow’s foot is a better way of denoting weak entities.</p>
<p>When the relationship between SALE and ITEM is drawn in Workbench, as shown in the following figure, there are two things to notice. <em>First</em>, the table, lineitem, maps the associative entity generated for the m:m relationship. <em>Second</em>, lineitem has an identifying relationship with sale and a non-identifying relationship with item.</p>
<p><em>An m:m relationship between SALE and ITEM in MySQL Workbench</em></p>
<p><img src="Figures/Chapter%205/sale-item-wb.png" /></p>
</div>
<div id="why-did-we-create-a-third-entity" class="section level3 hasAnchor" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Why did we create a third entity?<a href="the-many-to-many-relationship.html#why-did-we-create-a-third-entity" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we have an m:m relationship, we create an associative entity to store data about the relationship. In this case, we have to store data about the items sold. We cannot store the data with SALE because a sale can have many items, and an instance of an entity stores only single-value facts. Similarly, we cannot store data with ITEM because an item can appear in many sales. Since we cannot store data in SALE or ITEM, we must create another entity to store data about the m:m relationship.</p>
<p>You might find it useful to think of the m:m relationship as two 1:m relationships. An item can appear on many line item listings, and a line item entry refers to only one item. A sale has many line items, and each line item entry refers to only one sale.</p>
<blockquote>
<p><strong><em>Social Security number is notunique!</em></strong></p>
<p>Two girls named Sarah Lee Ferguson were born on May 3, 1959. The U.S. government considered them one and the same and issued both the same Social Security number (SSN), a nine-digit identifier of U.S. residents. Now Sarah Lee Ferguson Boles and Sarah Lee Ferguson Johnson share the same SSN.<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a></p>
<p>Mrs. Boles became aware of her SSN twin in 1987 when the Internal Revenue Service claimed there was a discrepancy in her reported income Because SSN is used as an identifier in IRS systems. Mrs. Boles encountered other incidents of mistaken identity. Some of Mrs. Johnson’s purchases appeared on Mrs. Boles’ credit reports.</p>
<p>In late 1989, the Social Security Administration notified Mrs. Boles that her original number was given to her in error and she had to provide evidence of her age, identity, and citizenship to get a new number. When Mrs. Boles got her new SSN, it is likely she had to also get a new driver’s license and establish a new credit history.</p>
</blockquote>
<!-- ## Creating a relational database with an m:m relationship  -->
<!-- As before, each entity becomes a table in a relational database, the entity name becomes the table name, each attribute becomes a column, and each identifier becomes a primary key. Remember, a 1:m relationship is mapped by adding a column to the entity of the many end of the relationship. The new column contains the identifier of the one end of the relationship. -->
<!-- Conversion of the foregoing data model results in the three tables following. Note the one-to-one correspondence between attributes and columns for sale and item. Observe the lineitem has two additional columns, saleno and itemno. Both of these columns are foreign keys in lineitem (remember the use of italics to signify foreign keys). Two foreign keys are required to record the two 1:m relationships. Notice in lineitem that saleno is both part of the primary key and a foreign key. -->
<!-- *Tables sale, lineitem, and item* -->
<!-- | *saleno | saledate   | saletext                                       | -->
<!-- |:---------|:-----------|:-----------------------------------------------| -->
<!-- | 1        | 2020-01-15 | Scruffy Australian---called himself Bruce.     | -->
<!-- | 2        | 2020-01-15 | Man. Rather fond of hats.                      | -->
<!-- | 3        | 2020-01-15 | Woman. Planning to row Atlantic---lengthwise!  | -->
<!-- | 4        | 2020-01-15 | Man. Trip to New York---thinks NY is a jungle! | -->
<!-- | 5        | 2020-01-16 | Expedition leader for African safari.          | -->
<!-- | *lineno | lineqty | lineprice | \**saleno* | *itemno* | -->
<!-- |:---------|--------:|----------:|--------------:|---------:| -->
<!-- | 1        |       1 |      4.50 |             1 |        2 | -->
<!-- | 1        |       1 |     25.00 |             2 |        6 | -->
<!-- | 2        |       1 |     20.00 |             2 |       16 | -->
<!-- | 3        |       1 |     25.00 |             2 |       19 | -->
<!-- | 4        |       1 |      2.25 |             2 |        2 | -->
<!-- | 1        |       1 |    500.00 |             3 |        4 | -->
<!-- | 2        |       1 |      2.25 |             3 |        2 | -->
<!-- | 1        |       1 |    500.00 |             4 |        4 | -->
<!-- | 2        |       1 |     65.00 |             4 |        9 | -->
<!-- | 3        |       1 |     60.00 |             4 |       13 | -->
<!-- | 4        |       1 |     75.00 |             4 |       14 | -->
<!-- | 5        |       1 |     10.00 |             4 |        3 | -->
<!-- | 6        |       1 |      2.25 |             4 |        2 | -->
<!-- | 1        |      50 |     36.00 |             5 |       10 | -->
<!-- | 2        |      50 |     40.50 |             5 |       11 | -->
<!-- | 3        |       8 |    153.00 |             5 |       12 | -->
<!-- | 4        |       1 |     60.00 |             5 |       13 | -->
<!-- | 5        |       1 |      0.00 |             5 |        2 | -->
<!-- | *itemno | itemname              | itemtype | itemcolor | -->
<!-- |:---------|:----------------------|:---------|:----------| -->
<!-- | 1        | Pocket knife---Nile   | E        | Brown     | -->
<!-- | 2        | Pocket knife---Avon   | E        | Brown     | -->
<!-- | 3        | Compass               | N        | ---       | -->
<!-- | 4        | Geopositioning system | N        | ---       | -->
<!-- | 5        | Map measure           | N        | ---       | -->
<!-- | 6        | Hat---Polar Explorer  | C        | Red       | -->
<!-- | 7        | Hat---Polar Explorer  | C        | White     | -->
<!-- | 8        | Boots---snake proof   | C        | Green     | -->
<!-- | 9        | Boots---snake proof   | C        | Black     | -->
<!-- | 10       | Safari chair          | F        | Khaki     | -->
<!-- | 11       | Hammock               | F        | Khaki     | -->
<!-- | 12       | Tent---8 person       | F        | Khaki     | -->
<!-- | 13       | Tent---2 person       | F        | Khaki     | -->
<!-- | 14       | Safari cooking kit    | E        | ---       | -->
<!-- | 15       | Pith helmet           | C        | Khaki     | -->
<!-- | 16       | Pith helmet           | C        | White     | -->
<!-- | 17       | Map case              | N        | Brown     | -->
<!-- | 18       | Sextant               | N        | ---       | -->
<!-- | 19       | Stetson               | C        | Black     | -->
<!-- | 20       | Stetson               | C        | Brown     | -->
<!-- The SQL commands to create the three tables are as follows: -->
<!-- ```{sql, connection = db, eval = FALSE} -->
<!-- CREATE TABLE sale ( -->
<!--    saleno      INTEGER, -->
<!--    saledate        DATE NOT NULL, -->
<!--    saletext        VARCHAR(50), -->
<!--      PRIMARY KEY(saleno)); -->
<!-- ``` -->
<!-- ```{sql, connection = db, eval = FALSE} -->
<!-- CREATE TABLE item ( -->
<!--    itemno      INTEGER, -->
<!--    itemname        VARCHAR(30) NOT NULL, -->
<!--    itemtype        CHAR(1) NOT NULL, -->
<!--    itemcolor       VARCHAR(10), -->
<!--        PRIMARY KEY(itemno)); -->
<!-- ``` -->
<!-- ```{sql, connection = db, eval = FALSE} -->
<!-- CREATE TABLE lineitem ( -->
<!--    lineno      INTEGER, -->
<!--    lineqty     INTEGER NOT NULL, -->
<!--    lineprice       DECIMAL(7,2) NOT NULL, -->
<!--    saleno      INTEGER, -->
<!--    itemno      INTEGER, -->
<!--        PRIMARY KEY(lineno,saleno), -->
<!--        CONSTRAINT fk_has_sale FOREIGN KEY(saleno) -->
<!--            REFERENCES sale(saleno), -->
<!--        CONSTRAINT fk_has_item FOREIGN KEY(itemno) -->
<!--            REFERENCES item(itemno)); -->
<!-- ``` -->
<!-- Although the `sale` and `item` tables are created in a similar fashion to previous examples, there are two things to note about the definition of `lineitem`. *First,* the primary key is a composite of `lineno` and `saleno`, because together they uniquely identify an instance of `lineitem`. *Second*, there are two foreign keys, because `lineno` is at the "many" end of two 1: m relationships. -->
<!-- > ❓ *Skill builder* -->
<!-- > -->
<!-- > A hamburger shop makes several types of hamburgers, and the same type of ingredient can be used with several types of hamburgers. This does not literally mean the same piece of lettuce is used many times, but lettuce is used with several types of hamburgers. Draw the data model for this situation. What is a good name for the associative entity? -->
</div>
</div>
<div id="querying-an-mm-relationship" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Querying an m:m relationship<a href="the-many-to-many-relationship.html#querying-an-mm-relationship" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="a-three-table-join" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> A three-table join<a href="the-many-to-many-relationship.html#a-three-table-join" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The join operation can be easily extended from two tables to three or more merely by specifying the tables to be joined and the matching conditions. For example:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb47-1"><a href="the-many-to-many-relationship.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> sale <span class="kw">JOIN</span> lineitem</span>
<span id="cb47-2"><a href="the-many-to-many-relationship.html#cb47-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> sale.saleno <span class="op">=</span> lineitem.saleno</span>
<span id="cb47-3"><a href="the-many-to-many-relationship.html#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">JOIN</span> item</span>
<span id="cb47-4"><a href="the-many-to-many-relationship.html#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> item.itemno <span class="op">=</span> lineitem.itemno;</span></code></pre></div>
<p>There are two matching conditions: one for <code>sale</code> and <code>lineitem</code> (<code>sale.saleno</code> = <code>lineitem.saleno</code>) and one for the item and <code>lineitem</code> tables (<code>item.itemno</code> = <code>lineitem.itemno</code>). The table <code>lineitem</code> is the link between <code>sale</code> and <code>item</code> and must be referenced in both matching conditions.</p>
<p>You can tailor the join to be more precise and report some columns rather than all.</p>
<p><em>List the name, quantity, price, and value of items sold on January 16, 2011.</em></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb48-1"><a href="the-many-to-many-relationship.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> itemname, lineqty, lineprice, lineqty<span class="op">*</span>lineprice <span class="kw">AS</span> total</span>
<span id="cb48-2"><a href="the-many-to-many-relationship.html#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">FROM</span> sale, lineitem, item</span>
<span id="cb48-3"><a href="the-many-to-many-relationship.html#cb48-3" aria-hidden="true" tabindex="-1"></a>        <span class="kw">WHERE</span> lineitem.saleno <span class="op">=</span> sale.saleno</span>
<span id="cb48-4"><a href="the-many-to-many-relationship.html#cb48-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">AND</span> item.itemno <span class="op">=</span> lineitem.itemno</span>
<span id="cb48-5"><a href="the-many-to-many-relationship.html#cb48-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">AND</span> saledate <span class="op">=</span> <span class="st">&#39;2011-01-16&#39;</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-48">Table 3.1: </span>5 records</caption>
<thead>
<tr class="header">
<th align="left">itemname</th>
<th align="right">lineqty</th>
<th align="right">lineprice</th>
<th align="right">total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Safari chair</td>
<td align="right">50</td>
<td align="right">36.0</td>
<td align="right">1800</td>
</tr>
<tr class="even">
<td align="left">Hammock</td>
<td align="right">50</td>
<td align="right">40.5</td>
<td align="right">2025</td>
</tr>
<tr class="odd">
<td align="left">Tent - 8 person</td>
<td align="right">8</td>
<td align="right">153.0</td>
<td align="right">1224</td>
</tr>
<tr class="even">
<td align="left">Tent - 2 person</td>
<td align="right">1</td>
<td align="right">60.0</td>
<td align="right">60</td>
</tr>
<tr class="odd">
<td align="left">Pocket knife - Avon</td>
<td align="right">1</td>
<td align="right">0.0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="existsdoes-a-value-exist" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> EXISTS—does a value exist<a href="the-many-to-many-relationship.html#existsdoes-a-value-exist" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>EXISTS is used in a WHERE clause to test whether a table contains at least one row satisfying a specified condition. It returns the value <strong>true</strong> if and only if some row satisfies the condition; otherwise it returns <strong>false</strong>. EXISTS represents the <strong>existential quantifier</strong> of formal logic. The best way to get a feel for EXISTS is to examine a query.</p>
<p><em>Report all clothing items (type “C”) for which a sale is recorded.</em></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb49-1"><a href="the-many-to-many-relationship.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> itemname, itemcolor <span class="kw">FROM</span> item</span>
<span id="cb49-2"><a href="the-many-to-many-relationship.html#cb49-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> itemtype <span class="op">=</span> <span class="st">&#39;C&#39;</span></span>
<span id="cb49-3"><a href="the-many-to-many-relationship.html#cb49-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> lineitem</span>
<span id="cb49-4"><a href="the-many-to-many-relationship.html#cb49-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">WHERE</span> lineitem.itemno <span class="op">=</span> item.itemno);</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-49">Table 3.2: </span>4 records</caption>
<thead>
<tr class="header">
<th align="left">itemname</th>
<th align="left">itemcolor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Hat - Polar explorer</td>
<td align="left">Red</td>
</tr>
<tr class="even">
<td align="left">Boots - snake proof</td>
<td align="left">Black</td>
</tr>
<tr class="odd">
<td align="left">Pith helmet</td>
<td align="left">White</td>
</tr>
<tr class="even">
<td align="left">Stetson</td>
<td align="left">Black</td>
</tr>
</tbody>
</table>
</div>
<p>Conceptually, we can think of this query as evaluating the subquery for each row of item. The first item with itemtype = ‘C’, Hat—Polar Explorer (red), in item has itemno = 6. Thus, the query becomes</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb50-1"><a href="the-many-to-many-relationship.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> itemname, itemcolor <span class="kw">FROM</span> item</span>
<span id="cb50-2"><a href="the-many-to-many-relationship.html#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> itemtype <span class="op">=</span> <span class="st">&#39;C&#39;</span></span>
<span id="cb50-3"><a href="the-many-to-many-relationship.html#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> <span class="kw">EXISTS</span> (<span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> lineitem</span>
<span id="cb50-4"><a href="the-many-to-many-relationship.html#cb50-4" aria-hidden="true" tabindex="-1"></a>        <span class="kw">WHERE</span> lineitem.itemno <span class="op">=</span> <span class="dv">6</span>);</span></code></pre></div>
<p>Because there is at least one row in <code>lineitem</code> with <code>itemno</code> = 6, the subquery returns <em>true</em>. The item has been sold and should be reported. The second clothing item, Hat—Polar Explorer (white), in <code>item</code> has <code>itemno</code> = 7. There are no rows in <code>lineitem</code> with <code>itemno</code> = 7, so the subquery returns <em>false</em>. That item has not been sold and should not be reported.</p>
<p>You can also think of the query as, “Select clothing items for which a sale exists.” Remember, for EXISTS to return <em>true</em>, there needs to be only one row for which the condition is <em>true</em>.</p>
</div>
<div id="not-existsselect-a-value-if-it-does-not-exist" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> NOT EXISTS—select a value if it does not exist<a href="the-many-to-many-relationship.html#not-existsselect-a-value-if-it-does-not-exist" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>NOT EXISTS is the negative of EXISTS. It is used in a WHERE clause to test whether all rows in a table fail to satisfy a specified condition. It returns the value <em>true</em> if there are no rows satisfying the condition; otherwise it returns <em>false</em>.</p>
<p><em>Report all clothing items that have not been sold.</em></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb51-1"><a href="the-many-to-many-relationship.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> itemname, itemcolor <span class="kw">FROM</span> item</span>
<span id="cb51-2"><a href="the-many-to-many-relationship.html#cb51-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> itemtype <span class="op">=</span> <span class="st">&#39;C&#39;</span></span>
<span id="cb51-3"><a href="the-many-to-many-relationship.html#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">AND</span> <span class="kw">NOT</span> <span class="kw">EXISTS</span></span>
<span id="cb51-4"><a href="the-many-to-many-relationship.html#cb51-4" aria-hidden="true" tabindex="-1"></a>        (<span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span> lineitem</span>
<span id="cb51-5"><a href="the-many-to-many-relationship.html#cb51-5" aria-hidden="true" tabindex="-1"></a>            <span class="kw">WHERE</span> item.itemno <span class="op">=</span> lineitem.itemno);</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-51">Table 3.3: </span>4 records</caption>
<thead>
<tr class="header">
<th align="left">itemname</th>
<th align="left">itemcolor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Hat - Polar explorer</td>
<td align="left">White</td>
</tr>
<tr class="even">
<td align="left">Boots - snake proof</td>
<td align="left">Green</td>
</tr>
<tr class="odd">
<td align="left">Pith helmet</td>
<td align="left">Khaki</td>
</tr>
<tr class="even">
<td align="left">Stetson</td>
<td align="left">Brown</td>
</tr>
</tbody>
</table>
</div>
<p>You can also think of the query as, “Select clothing items for which no sales exist.” Also remember, for NOT EXISTS to return <em>true</em>, no rows should satisfy the condition.</p>
<blockquote>
<p>❓ <em>Skill builder</em></p>
<p>Report all red items that have not been sold. Write the query twice, once using EXISTS and once without EXISTS.</p>
</blockquote>
<!-- ### Divide (and be conquered)  -->
<!-- In addition to the existential quantifier that you have already encountered, formal logic has a **universal quantifier** known as **forall** that is necessary for queries such as -->
<!-- Find the items that have appeared in all sales. -->
<!-- If a universal quantifier were supported by SQL, this query could be phrased as, "Select item names where *forall* sales there *exists* a `lineitem` row recording that this item was sold." A quick inspection of the first set of tables shows that one item satisfies this condition (`itemno` = 2). -->
<!-- While SQL does not directly support the universal quantifier, formal logic shows that *forall* can be expressed using EXISTS. The query becomes, "Find items such that there does not exist a sale in which this item does not appear." The equivalent SQL expression is -->
<!-- ```{sql, connection = db, eval = T} -->
<!-- SELECT itemno, itemname FROM item -->
<!--    WHERE NOT EXISTS -->
<!--        (SELECT * FROM sale -->
<!--            WHERE NOT EXISTS -->
<!--                (SELECT * FROM lineitem -->
<!--                    WHERE lineitem.itemno = item.itemno -->
<!--                    AND lineitem.saleno = sale.saleno)); -->
<!-- ``` -->
<!-- If you are interested in learning the inner workings of the preceding SQL for divide, see the additional material for Chapter 5 on the book's Web site. -->
<!-- Relational algebra (Chapter 9) has the divide operation, which makes divide queries easy to write. Be careful: Not all queries containing the word *all* are divides. With experience, you will learn to recognize and conquer divide. -->
<!-- To save the tedium of formulating this query from scratch, we have developed a template for dealing with these sorts of queries. Divide queries typically occur with m:m relationships. -->
<!-- *A template for divide* -->
<!-- ![](Figures/Chapter%205/divide%20template.png){width="566"} -->
<!-- An appropriate generic query and template SQL command are -->
<!-- *Find the target1 that have appeared in all sources.* -->
<!-- ```{sql, connection = db, eval = FALSE} -->
<!-- SELECT target1 FROM target -->
<!--    WHERE NOT EXISTS -->
<!--        (SELECT * FROM source -->
<!--            WHERE NOT EXISTS -->
<!--                (SELECT * FROM target-source -->
<!--                    WHERE target-source.target# = target.target# -->
<!--                    AND target-source.source# = source.source#)); -->
<!-- ``` -->
<!-- > ❓ *Skill builder* -->
<!-- > -->
<!-- > Find the brown items that have appeared in all sales. -->
<!-- ### Beyond the great divide {.unnumbered} -->
<!-- Divide proves troublesome to most people because of the double negative---we just don't think that way. If divide sends your neurons into knots, then try the following approach. -->
<!-- The query "Find the items that have appeared in all sales" can be rephrased as "Find the items for which the number of sales that include this item is equal to the total number of sales." This is an easier query to write than "Find items such that there does not exist a sale in which this item does not appear." -->
<!-- The rephrased query has two parts. *First**,*** determine the total number of sales. Here we mean distinct sales (i.e., the number of rows with a distinct value for saleno). The SQL is -->
<!-- ```{sql, connection = db, eval =FALSE} -->
<!-- SELECT COUNT (DISTINCT saleno) FROM sale; -->
<!-- ``` -->
<!-- *Second*, group the items sold by `itemno` and `itemname` and use a HAVING clause with COUNT to calculate the number of sales in which the item has occurred. Forcing the count in the HAVING clause to equal the result of the first query, which becomes an inner query, results in a list of items appearing in all sales. -->
<!-- ```{sql, connection = db, eval = FALSE} -->
<!-- SELECT item.itemno, item.itemname -->
<!--    FROM item JOIN lineitem -->
<!--        ON item.itemno = lineitem.itemno -->
<!--            GROUP BY item.itemno, item.itemname -->
<!--                HAVING COUNT(DISTINCT saleno) -->
<!--                    = (SELECT COUNT(DISTINCT saleno) FROM sale); -->
<!-- ``` -->
</div>
<div id="set-operations" class="section level3 unnumbered hasAnchor">
<h3>Set operations<a href="the-many-to-many-relationship.html#set-operations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Set operators are useful for combining the values derived from two or more SQL queries. The UNION operation is equivalent to <em>or</em>.</p>
<p><em>List items that were sold on January 16, 2011, or are brown.</em></p>
<p>Resolution of this query requires two tables: one to report items sold on January 16, 2011, and one to report the brown items. UNION (i.e., or) then combines the results of the tables, including <em>any</em> rows in both tables and excluding duplicate rows.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode sql"><code class="sourceCode sql"><span id="cb52-1"><a href="the-many-to-many-relationship.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> itemname <span class="kw">FROM</span> item <span class="kw">JOIN</span> lineitem</span>
<span id="cb52-2"><a href="the-many-to-many-relationship.html#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> item.itemno <span class="op">=</span> lineitem.itemno</span>
<span id="cb52-3"><a href="the-many-to-many-relationship.html#cb52-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">JOIN</span> sale</span>
<span id="cb52-4"><a href="the-many-to-many-relationship.html#cb52-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">ON</span> lineitem.saleno <span class="op">=</span> sale.saleno</span>
<span id="cb52-5"><a href="the-many-to-many-relationship.html#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">WHERE</span> saledate <span class="op">=</span> <span class="st">&#39;2011-01-16&#39;</span></span>
<span id="cb52-6"><a href="the-many-to-many-relationship.html#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="kw">UNION</span></span>
<span id="cb52-7"><a href="the-many-to-many-relationship.html#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">SELECT</span> itemname <span class="kw">FROM</span> item <span class="kw">WHERE</span> itemcolor <span class="op">=</span> <span class="st">&#39;Brown&#39;</span>;</span></code></pre></div>
<div class="knitsql-table">
<table>
<caption><span id="tab:unnamed-chunk-52">Table 3.4: </span>8 records</caption>
<thead>
<tr class="header">
<th align="left">itemname</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Safari chair</td>
</tr>
<tr class="even">
<td align="left">Hammock</td>
</tr>
<tr class="odd">
<td align="left">Tent - 8 person</td>
</tr>
<tr class="even">
<td align="left">Tent - 2 person</td>
</tr>
<tr class="odd">
<td align="left">Pocket knife - Avon</td>
</tr>
<tr class="even">
<td align="left">Pocket knife - Nile</td>
</tr>
<tr class="odd">
<td align="left">Map case</td>
</tr>
<tr class="even">
<td align="left">Stetson</td>
</tr>
</tbody>
</table>
</div>
<!-- *List items that were sold on January 16, 2011, and are brown.* -->
<!-- This query uses the same two tables as the previous query. In this case, INTERSECT (i.e., and) then combines the results of the tables including ***only*** rows in both tables and excluding duplicates.[^manytomany-2] -->
<!-- [^manytomany-2]: MySQL does not support INTERSECT. Use another AND in the WHERE statement. -->
<!-- ```{sql, connection = db, eval = F} -->
<!-- SELECT itemname FROM item JOIN lineitem -->
<!--    ON item.itemno = lineitem.itemno -->
<!--    JOIN sale -->
<!--    ON lineitem.saleno = sale.saleno -->
<!--    WHERE saledate = '2011-01-16' -->
<!-- INTERSECT -->
<!--    SELECT itemname FROM item WHERE itemcolor = 'Brown'; -->
<!-- ``` -->
<blockquote>
<p>❓ <em>Skill builder</em></p>
<p>List the items that contain the words “Hat”, “Helmet”, or “Stetson” in their names</p>
</blockquote>
</div>
</div>
<div id="summary-2" class="section level2 unnumbered hasAnchor">
<h2>Summary<a href="the-many-to-many-relationship.html#summary-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There can be a many-to-many (m:m) relationship between entities, which is represented by creating an associative entity and two 1:m relationships. An associative entity stores data about an m:m relationship. The join operation can be extended from two tables to three or more tables. EXISTS tests whether a table has at least one row that meets a specified condition. NOT EXISTS tests whether all rows in a table do not satisfy a specified condition. Both EXISTS and NOT EXISTS can return <em>true</em> or <em>false</em>. The relational operation divide, also known as <em>forall</em>, can be translated into a double negative. It is represented in SQL by a query containing two NOT EXISTS statements. Set operations enable the results of queries to be combined.</p>
</div>
<div id="key-terms-and-concepts-2" class="section level2 unnumbered hasAnchor">
<h2>Key terms and concepts<a href="the-many-to-many-relationship.html#key-terms-and-concepts-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<tbody>
<tr class="odd">
<td align="left">Associative entity</td>
<td>Many-to-many (m:m) relationship</td>
</tr>
<tr class="even">
<td align="left">Divide</td>
<td>NOT EXISTS</td>
</tr>
<tr class="odd">
<td align="left">Existential quantifier</td>
<td>UNION</td>
</tr>
<tr class="even">
<td align="left">EXISTS</td>
<td>Universal quantifier</td>
</tr>
<tr class="odd">
<td align="left">INTERSECT</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<div id="exercises-2" class="section level2 unnumbered hasAnchor">
<h2>Exercises<a href="the-many-to-many-relationship.html#exercises-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<!-- 1.  Draw data models for the following situations. In each case, think about the names you give each entity: -->
<!--     a.  Farmers can own cows or share cows with other farmers. -->
<!--     b.  A track and field meet can have many competitors, and a competitor can participate in more than one event. -->
<!--     c.  A patient can have many physicians, and a physician can have many patients. -->
<!--     d.  A student can attend more than one class, and the same class can have many students. -->
<!--     e.  *The Marathoner*, a monthly magazine, regularly reports the performance of professional marathon runners. It has asked you to design a database to record the details of all major marathons (e.g., Boston, London, and Paris). Professional marathon runners compete in several races each year. A race may have thousands of competitors, but only about 200 or so are professional runners, the ones *The Marathoner* tracks. For each race, the magazine reports a runner's time and finishing position and some personal details such as name, gender, and age. -->
<!-- 2.  The data model shown was designed by a golf statistician. Write SQL statements to create the corresponding relational database. -->
<!-- ![](Figures/Chapter%205/golf.png){width="523"} -->
<ol start="3" style="list-style-type: decimal">
<li><p>Write the following SQL queries for the database described in this chapter:</p>
<ol style="list-style-type: lower-alpha">
<li><p>List the names of items for which the quantity sold is greater than one for any sale.</p></li>
<li><p>Compute the total value of sales for each item by date.</p></li>
<li><p>Report all items of type “F” that have been sold.</p></li>
<li><p>List all items of type “F” that have not been sold.</p></li>
<li><p>Compute the total value of each sale.</p></li>
</ol></li>
<li><p>Why do you have to create a third entity when you have an m:m relationship?</p></li>
<li><p>What does a plus sign near a relationship arc mean?</p></li>
<li><p>How does EXISTS differ from other clauses in an SQL statement?</p></li>
<li><p>Answer the following queries based on the described relational database.</p>
<p><img src="Figures/Chapter%205/gift.png" width="443" /></p>
<ol style="list-style-type: lower-alpha">
<li><p>List the phone numbers of donors Hays and Jefts.</p></li>
<li><p>How many donors are there in the donor table?</p></li>
<li><p>How many people made donations in 1999?</p></li>
<li><p>What is the name of the person who made the largest donation in 1999?</p></li>
<li><p>What was the total amount donated in 2000?</p></li>
<li><p>List the donors who have made a donation every year.</p></li>
<li><p>List the donors whose average donation is more than twice the average donation of all donors.</p></li>
<li><p>List the total amount given by each person across all years; sort the report by the donor’s name.</p></li>
<li><p>Report the total donations in 2001 by state.</p></li>
<li><p>In which years did the total donated exceed the goal for the year?</p></li>
</ol></li>
</ol>
<!-- 8.  The following table records data found on the side of a breakfast cereal carton. Use these data as a guide to develop a data model to record nutrition facts for a meal. In this case, a meal is a cup of cereal and 1/2 cup of skim milk. -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | **Nutrition facts**             |             |                           | -->
<!-- | Serving size 1 cup (30g)        |             |                           | -->
<!-- | Servings per container about 17 |             |                           | -->
<!-- +=================================+============:+==========================:+ -->
<!-- | Amount per serving              | Cereal      | with 1/2 cup of skim milk | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Calories                        | 110         | 150                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Calories from Fat               | 10          | 10                        | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- |                                 |             | % Daily Value            | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Total Fat 1g                    | 1%          | 2%                        | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Saturated Fat 0g                | 0%          | 0%                        | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Polyunsaturated Fat 0g          |             |                           | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Monounsaturated Fat 0g          |             |                           | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Cholesterol 0mg                 | 0%          | 1%                        | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Sodium 220mg                    | 9%          | 12%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Potassium 105 mg                | 3%          | 9%                        | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Total Carbohydrate 24g          | 8%          | 10%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Dietary Fiber 3g                | 13%         | 13%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Sugars 4g                       |             |                           | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Other Carbohydrate 17g          |             |                           | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Protein 3g                      |             |                           | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Vitamin A                       | 10%         | 15%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Vitamin C                       | 10%         | 10%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Calcium                         | 2%          | 15%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Iron                            | 45%         | 45%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Vitamin D                       | 10%         | 25%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Thiamin                         | 50%         | 50%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Riboflavin                      | 50%         | 50%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Niacin                          | 50%         | 50%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Vitamin B12                     | 50%         | 60%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Phosphorus                      | 10%         | 20%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Magnesium                       | 8%          | 10%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Zinc                            | 50%         | 50%                       | -->
<!-- +---------------------------------+-------------+---------------------------+ -->
<!-- | Copper                          | 4%          | 4%                        | -->
<!-- +---------------------------------+-------------+---------------------------+ -->

</div>
</div>
<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>“Two women share a name, birthday, and S.S. number!” Athens Daily News, January 29 1990, 7A. Also, see <a href="https://www.computerworld.com/article/3004659/a-tale-of-two-women-same-birthday-same-social-security-number-same-big-data-mess.html" class="uri">https://www.computerworld.com/article/3004659/a-tale-of-two-women-same-birthday-same-social-security-number-same-big-data-mess.html</a><a href="the-many-to-many-relationship.html#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="the-one-to-many-relationship.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="sql.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/103-manytomany.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["DataManagement.pdf", "DataManagement.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
